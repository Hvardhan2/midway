"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3285],{3905:(e,r,t)=>{t.d(r,{Zo:()=>u,kt:()=>m});var n=t(7294);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function a(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?s(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),c=function(e){var r=n.useContext(l),t=r;return e&&(t="function"==typeof e?e(r):a(a({},r),e)),t},u=function(e){var r=c(e.components);return n.createElement(l.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(t),m=o,f=d["".concat(l,".").concat(m)]||d[m]||p[m]||s;return t?n.createElement(f,a(a({ref:r},u),{},{components:t})):n.createElement(f,a({ref:r},u))}));function m(e,r){var t=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var s=t.length,a=new Array(s);a[0]=d;var i={};for(var l in r)hasOwnProperty.call(r,l)&&(i[l]=r[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var c=2;c<s;c++)a[c]=t[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},3573:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=t(7462),o=(t(7294),t(3905));const s={title:"\u9ed8\u8ba4\u9519\u8bef\u884c\u4e3a"},a=void 0,i={unversionedId:"serverless/serverless_error",id:"serverless/serverless_error",title:"\u9ed8\u8ba4\u9519\u8bef\u884c\u4e3a",description:"Error value processing",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/serverless/serverless_error.md",sourceDirName:"serverless",slug:"/serverless/serverless_error",permalink:"/en/docs/serverless/serverless_error",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/serverless_error.md",tags:[],version:"current",frontMatter:{title:"\u9ed8\u8ba4\u9519\u8bef\u884c\u4e3a"},sidebar:"serverless",previous:{title:"Deployment environment",permalink:"/en/docs/serverless/serverless_environment"},next:{title:"Aliyun FC",permalink:"/en/docs/serverless/aliyun_faas"}},l={},c=[{value:"Error value processing",id:"error-value-processing",level:2},{value:"Adjustment error return",id:"adjustment-error-return",level:2}],u={toc:c};function p(e){let{components:r,...t}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"error-value-processing"},"Error value processing"),(0,o.kt)("p",null,"In order to ensure security, Midway has done some special treatment for errors returned in Serverless scenarios."),(0,o.kt)("p",null,'When the function business throws an error, the frame side will catch all the errors and return the error of "Internal Server Error.'),(0,o.kt)("p",null,"For example, our function returns an error:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(//...)\nasync invoke() {\n  throw new Error('abc');\n}\n")),(0,o.kt)("p",null,"Whether it is HTTP or non-HTTP triggers, the framework part has corresponding processing."),(0,o.kt)("p",null,"In ",(0,o.kt)("strong",{parentName:"p"},"off-line environments"),", such as ",(0,o.kt)("inlineCode",{parentName:"p"},"NODE_ENV = local"),", the framework will reveal the entire error through the gateway."),(0,o.kt)("p",null,"For example (complete error stack):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"2021-07-02T05:57:08.553Z 19be4d99-c9cb-4c4c-aac2-9330d31b4408 [error] Error: abc\n    at hello (/code/dist/function/index.js:17:15)\n    at invokeHandler (/code/node_modules/_@midwayjs_faas@2.11.2-beta.1@@midwayjs/faas/dist/framework.js:174:56)\n    at processTicksAndRejections (internal/process/task_queues.js:97:5)\n    at (/code/node_modules/_@midwayjs_faas@2.11.2-beta.1@@midwayjs/faas/dist/framework.js:117:40)\n    at cors (/code/node_modules/_@koa_cors@3.1.0@@koa/cors/index.js:98:16)\n    at invokeHandlerWrapper (/code/node_modules/_@midwayjs_runtime-engine@2.11.1@@midwayjs/runtime-engine/dist/lightRuntime.js:18:28) {\n}\n")),(0,o.kt)("p",null,"In the online environment, the framework will directly return ",(0,o.kt)("strong",{parentName:"p"},'"Internal Server Error"'),", but the log is a complete stack."),(0,o.kt)("p",null,"As shown in Fig."),(0,o.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2021/png/501408/1625205528496-96f7d2b8-d728-4f04-82f4-f2617e00720b.png#clientId=uf90c84ad-5af6-4&from=paste&height=184&id=u9c48573b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=184&originWidth=533&originalType=binary&ratio=1&size=7090&status=done&style=none&taskId=u9ff827c3-41a4-4b19-bedb-83ee598cc4e&width=533",width:"533"}),(0,o.kt)("h2",{id:"adjustment-error-return"},"Adjustment error return"),(0,o.kt)("p",null,"The above is the default behavior. If an error needs to be displayed in a special environment, you can use the environment variable to enable forced output."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"process.env.SERVERLESS_OUTPUT_ERROR_STACK = 'true';\n")))}p.isMDXComponent=!0}}]);