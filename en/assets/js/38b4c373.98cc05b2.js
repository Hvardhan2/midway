"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1892],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=i,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||a;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6730:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var r=n(87462),i=(n(67294),n(3905));const a={},o="Develop function",l={unversionedId:"serverless/serverless_dev",id:"serverless/serverless_dev",title:"Develop function",description:"Initialization code",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/serverless/serverless_dev.md",sourceDirName:"serverless",slug:"/serverless/serverless_dev",permalink:"/en/docs/serverless/serverless_dev",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/serverless_dev.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Migrate from Serverless v2 to v3",permalink:"/en/docs/serverless/serverless_v2_upgrade_serverless_v3"},next:{title:"Test function",permalink:"/en/docs/serverless/serverless_testing"}},s={},c=[{value:"Initialization code",id:"initialization-code",level:2},{value:"Directory Structure",id:"directory-structure",level:2},{value:"Function file",id:"function-file",level:2},{value:"Function definition file",id:"function-definition-file",level:2},{value:"Trigger decorator parameters",id:"trigger-decorator-parameters",level:2},{value:"Function decorator parameters",id:"function-decorator-parameters",level:2},{value:"Local development",id:"local-development",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"develop-function"},"Develop function"),(0,i.kt)("h2",{id:"initialization-code"},"Initialization code"),(0,i.kt)("p",null,"Let's develop our first pure HTTP function and try to deploy it to a cloud environment."),(0,i.kt)("p",null,"Execute ",(0,i.kt)("inlineCode",{parentName:"p"},"npm init midway")," and select the ",(0,i.kt)("inlineCode",{parentName:"p"},"faas")," scaffolding."),(0,i.kt)("h2",{id:"directory-structure"},"Directory Structure"),(0,i.kt)("p",null,"The following is the most streamlined structure of a function. The core will include a ",(0,i.kt)("inlineCode",{parentName:"p"},"f.yml")," standardized function file and the TypeScript project structure."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 f.yml             # Standardized spec file\n\u251c\u2500\u2500 package.json      # Project dependencies\n\u251c\u2500\u2500 src\n\u2502   \u2514\u2500\u2500 function\n\u2502       \u2514\u2500\u2500 hello.ts    # Function file\n\u2514\u2500\u2500 tsconfig.json\n")),(0,i.kt)("p",null,"Let\u2019s take a brief look at the file contents."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"f.yml")," function definition file"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tsconfig.json")," TypeScript configuration file"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"src")," function source code directory"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"src/function/hello.ts")," sample function file")),(0,i.kt)("p",null,"We place functions in the ",(0,i.kt)("inlineCode",{parentName:"p"},"function")," directory to better separate them from other types of code."),(0,i.kt)("h2",{id:"function-file"},"Function file"),(0,i.kt)("p",null,"Let\u2019s first take a look at the function file. The traditional function is a ",(0,i.kt)("inlineCode",{parentName:"p"},"function"),". In order to be more consistent with the midway system and use our dependency injection, it is turned into a Class here."),(0,i.kt)("p",null,"Through the ",(0,i.kt)("inlineCode",{parentName:"p"},"@ServerlessTrigger")," decorator, we mark the method as an HTTP interface and mark the ",(0,i.kt)("inlineCode",{parentName:"p"},"path")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"method")," attributes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType, Query } from '@midwayjs/core';\nimport { Context } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloHTTPService {\n   @Inject()\n   ctx: Context;\n\n   @ServerlessTrigger(ServerlessTriggerType.HTTP, {\n     path: '/',\n     method: 'get',\n   })\n   async handleHTTPEvent(@Query() name = 'midway') {\n     return `hello ${name}`;\n   }\n}\n")),(0,i.kt)("p",null,"In addition to triggers, we can also use the ",(0,i.kt)("inlineCode",{parentName:"p"},"@ServerlessFunction")," decorator to describe function-level meta-information, such as function name, concurrency, etc."),(0,i.kt)("p",null,"In this way, when we use multiple triggers on a function, we can set it up like this."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessFunction, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/core';\nimport { Context } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloServerlessService {\n   @Inject()\n   ctx: Context;\n\n   // Multiple triggers for one function\n   @ServerlessFunction({\n     functionName: 'abcde',\n   })\n   @ServerlessTrigger(ServerlessTriggerType.TIMER, {\n     name: 'timer'\n   })\n   async handleTimerEvent() {\n     //TODO\n   }\n}\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Note that some platforms cannot put different types of triggers in the same function. For example, Alibaba Cloud stipulates that HTTP triggers and other triggers cannot take effect in the same function at the same time.")),(0,i.kt)("h2",{id:"function-definition-file"},"Function definition file"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"f.yml")," is a file with framework identification function information, the content is as follows."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"provider:\n   name: aliyun #Publishing platform, here is Alibaba Cloud\n   starter: '@midwayjs/fc-starter'\n\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"@midwayjs/fc-starter")," here is the adapter that adapts to the aliyun function."),(0,i.kt)("h2",{id:"trigger-decorator-parameters"},"Trigger decorator parameters"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"@ServerlessTrigger")," decorator is used to define different triggers. Its parameters are each trigger information and general trigger parameters."),(0,i.kt)("p",null,"For example, the trigger name is changed to abc."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"   @ServerlessTrigger(ServerlessTriggerType.TIMER, {\n     name: 'abc', // Trigger name\n   })\n")),(0,i.kt)("p",null,"If there is only one trigger, you can write the function name information to the trigger."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"   @ServerlessTrigger(ServerlessTriggerType.TIMER, {\n   functionName: 'hello' // If there is only one trigger, you can omit a decorator\n     name: 'abc',\n   })\n")),(0,i.kt)("h2",{id:"function-decorator-parameters"},"Function decorator parameters"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"@ServerlessFunction")," decorator is used to define functions. If there are multiple triggers, the function name can be modified uniformly."),(0,i.kt)("p",null,"for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessFunction({\n   functionName: 'abcde' // function name\n})\n")),(0,i.kt)("h2",{id:"local-development"},"Local development"),(0,i.kt)("p",null,"Local development of HTTP functions is the same as traditional Web. Enter the following command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ npm rundev\n$ open http://localhost:7001\n")),(0,i.kt)("p",null,"Midway will start the HTTP server, open the browser, visit ",(0,i.kt)("a",{parentName:"p",href:"http://127.0.0.1:7001"},"http://127.0.0.1:7001"),", the browser will print out the ",(0,i.kt)("inlineCode",{parentName:"p"},"Hello midwayjs")," information."),(0,i.kt)("p",null,"Non-HTTP functions cannot be triggered directly. Instead, you can write test functions for execution."))}d.isMDXComponent=!0}}]);