"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[28513],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),m=a,f=u["".concat(l,".").concat(m)]||u[m]||d[m]||s;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:a,o[1]=i;for(var c=2;c<s;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},24833:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const s={},o="Test function",i={unversionedId:"serverless/serverless_testing",id:"serverless/serverless_testing",title:"Test function",description:"Functions of HTTP classes",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/serverless/serverless_testing.md",sourceDirName:"serverless",slug:"/serverless/serverless_testing",permalink:"/en/docs/serverless/serverless_testing",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/serverless_testing.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Develop function",permalink:"/en/docs/serverless/serverless_dev"},next:{title:"Function Context",permalink:"/en/docs/serverless/serverless_context"}},l={},c=[{value:"Functions of HTTP classes",id:"functions-of-http-classes",level:2},{value:"Ordinary trigger",id:"ordinary-trigger",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"test-function"},"Test function"),(0,a.kt)("h2",{id:"functions-of-http-classes"},"Functions of HTTP classes"),(0,a.kt)("p",null,"This method is applicable to all functions of HTTP-like triggers, including ",(0,a.kt)("inlineCode",{parentName:"p"},"HTTP")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"API_GATEWAY"),"."),(0,a.kt)("p",null,"Use the same test method as the application to test. For HTTP functions, use the supertest encapsulated ",(0,a.kt)("inlineCode",{parentName:"p"},"createHttpRequest")," method to create HTTP clients."),(0,a.kt)("p",null,"The only difference from the application is that the ",(0,a.kt)("inlineCode",{parentName:"p"},"createFunctionApp")," method is used to create a function application (app)."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"createFunctionApp")," is a customized method of ",(0,a.kt)("inlineCode",{parentName:"p"},"createApp")," in the function scenario."),(0,a.kt)("p",null,"The HTTP test code is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close, createHttpRequest } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/faas';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n\n  it('should get result from api gateway trigger', async () => {\n    \n    const app: Application = await createFunctionApp<Framework>();\n    \n    const result = await createHttpRequest(app).get('/').query({\n      name: 'zhangting',\n    });\n    expect(result.text).toEqual('hello zhangting');\n    \n    await close(app);\n\n  });\n});\n")),(0,a.kt)("h2",{id:"ordinary-trigger"},"Ordinary trigger"),(0,a.kt)("p",null,"In addition to HTTP-like triggers, we also have other function triggers such as timers and object storage. Since these triggers are closely related to the gateway, they cannot be tested using HTTP behavior. Instead, they use traditional method calls."),(0,a.kt)("p",null,"Create a function app through the ",(0,a.kt)("inlineCode",{parentName:"p"},"createFunctionApp")," method, obtain the class instance through the ",(0,a.kt)("inlineCode",{parentName:"p"},"getServerlessInstance")," method, and then call it directly through the instance method and pass in the parameters for testing."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close, createHttpRequest } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/faas';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n\n   it('should get result from event trigger', async () => {\n     //Create function app\n     let app: Application = await createFunctionApp<Framework>();\n    \n     // Get the service class\n     const instance = await app.getServerlessInstance<HelloAliyunService>(HelloAliyunService);\n    \n     // Call the function method and pass in parameters\n     expect(await instance.handleEvent('hello world')).toEqual('hello world');\n    \n     await close(app);\n   });\n});\n")))}d.isMDXComponent=!0}}]);