"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[98152],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>v});var r=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(t),u=s,v=d["".concat(l,".").concat(u)]||d[u]||m[u]||a;return t?r.createElement(v,o(o({ref:n},c),{},{components:t})):r.createElement(v,o({ref:n},c))}));function v(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,o=new Array(a);o[0]=u;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[d]="string"==typeof e?e:s,o[1]=i;for(var p=2;p<a;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},75856:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var r=t(87462),s=(t(67294),t(3905));const a={},o="Migrate from Serverless v2 to v3",i={unversionedId:"serverless/serverless_v2_upgrade_serverless_v3",id:"serverless/serverless_v2_upgrade_serverless_v3",title:"Migrate from Serverless v2 to v3",description:"Based on the upgrade of Midway to v3, the Serverless system has also been upgraded to the v3 version simultaneously.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/serverless/serverless_v2_upgrade_serverless_v3.md",sourceDirName:"serverless",slug:"/serverless/serverless_v2_upgrade_serverless_v3",permalink:"/en/docs/serverless/serverless_v2_upgrade_serverless_v3",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/serverless_v2_upgrade_serverless_v3.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Introduce",permalink:"/en/docs/serverless/serverless_intro"},next:{title:"Develop function",permalink:"/en/docs/serverless/serverless_dev"}},l={},p=[{value:"1. Upgrade of project package version",id:"1-upgrade-of-project-package-version",level:2},{value:"2. Changes to the main entrance frame",id:"2-changes-to-the-main-entrance-frame",level:2},{value:"3. Test code changes",id:"3-test-code-changes",level:2},{value:"5. Changes in deployment methods",id:"5-changes-in-deployment-methods",level:2}],c={toc:p},d="wrapper";function m(e){let{components:n,...t}=e;return(0,s.kt)(d,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"migrate-from-serverless-v2-to-v3"},"Migrate from Serverless v2 to v3"),(0,s.kt)("p",null,"Based on the upgrade of Midway to v3, the Serverless system has also been upgraded to the v3 version simultaneously."),(0,s.kt)("p",null,"This article describes how to migrate from Serverless v2.0 to Serverless v3.0, which is very similar to traditional application upgrades."),(0,s.kt)("admonition",{type:"caution"},(0,s.kt)("p",{parentName:"admonition"},"The new Serverless currently only supports Alibaba Cloud functions.")),(0,s.kt)("h2",{id:"1-upgrade-of-project-package-version"},"1. Upgrade of project package version"),(0,s.kt)("p",null,"Some dependency package upgrades include:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Midway and component versions upgraded to 3.x"),(0,s.kt)("li",{parentName:"ul"},"CLI, Jest and other version upgrades"),(0,s.kt)("li",{parentName:"ul"},"Removed some no longer used dependencies, such as ",(0,s.kt)("inlineCode",{parentName:"li"},"@midwayjs/serverless-app"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-diff"},'"scripts": {\n   "dev": "cross-env NODE_ENV=local midway-bin dev --ts",\n   "test": "cross-env midway-bin test --ts",\n- "deploy": "cross-env UDEV_NODE_ENV=production midway-bin deploy",\n   "lint": "mwts check",\n   "lint:fix": "mwts fix"\n},\n"dependencies": {\n- "@midwayjs/core": "^2.3.0",\n- "@midwayjs/decorator": "^2.3.0",\n- "@midwayjs/faas": "^2.0.0"\n+ "@midwayjs/core": "^3.12.0",\n+ "@midwayjs/faas": "^3.12.0",\n+ "@midwayjs/fc-starter": "^3.12.0",\n+ "@midwayjs/logger": "^2.0.0"\n},\n"devDependencies": {\n- "@midwayjs/cli": "^1.2.45",\n- "@midwayjs/cli-plugin-faas": "^1.2.45",\n- "@midwayjs/fcli-plugin-fc": "^1.2.45",\n- "@midwayjs/mock": "^2.8.7",\n- "@midwayjs/serverless-app": "^2.8.7",\n- "@midwayjs/serverless-fc-trigger": "^2.10.3",\n- "@midwayjs/serverless-fc-starter": "^2.10.3",\n- "@types/jest": "^26.0.10",\n- "@types/node": "14",\n- "cross-env": "^6.0.0",\n- "jest": "^26.4.0",\n- "mwts": "^1.0.5",\n- "ts-jest": "^26.2.0",\n- "typescript": "~4.6.0"\n+ "@midwayjs/mock": "^3.12.0",\n+ "@types/jest": "29",\n+ "@types/node": "16",\n+ "cross-env": "^7.0.3",\n+ "jest": "29",\n+ "mwts": "^1.3.0",\n+ "ts-jest": "29",\n+ "ts-node": "^10.9.1",\n+ "typescript": "~5.1.0"\n}\n')),(0,s.kt)("h2",{id:"2-changes-to-the-main-entrance-frame"},"2. Changes to the main entrance frame"),(0,s.kt)("p",null,"Explicitly declare faas as the main framework."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/configuration\nimport * as faas from '@midwayjs/faas';\n\n@Configuration({\n   // ...\n   imports: [\n     faas\n   ],\n})\nexport class MainConfiguration {\n   // ...\n}\n\n")),(0,s.kt)("h2",{id:"3-test-code-changes"},"3. Test code changes"),(0,s.kt)("p",null,"Removed dependency on ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/serverless-app"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-diff"},"import { createFunctionApp, close, createHttpRequest } from '@midwayjs/mock';\n- import { Framework, Application } from '@midwayjs/serverless-app';\n+ import { Framework, Application } from '@midwayjs/faas';\n")),(0,s.kt)("p",null,"Removed ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/serverless-fc-trigger")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/serverless-fc-starter")," dependencies and changed to ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/fc-starter"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Application, Context, Framework } from '@midwayjs/faas';\nimport { mockContext } from '@midwayjs/fc-starter';\nimport { createFunctionApp } from '@midwayjs/mock';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n\n   it('should get result from event trigger', async () => {\n    \n     // create app\n     const app: Application = await createFunctionApp<Framework>(join(__dirname, '../'), {\n       initContext: Object.assign(mockContext(), {\n         function: {\n           name: '***',\n           handler: '***'\n         }\n       }),\n     });\n    \n     // ...\n    \n     await close(app);\n   });\n});\n")),(0,s.kt)("p",null,"Some API replacements, such as the original ",(0,s.kt)("inlineCode",{parentName:"p"},"createXXXEvent"),", will become ",(0,s.kt)("inlineCode",{parentName:"p"},"mockXXXEvent"),", and the original ",(0,s.kt)("inlineCode",{parentName:"p"},"createInitializeContext")," will become the ",(0,s.kt)("inlineCode",{parentName:"p"},"mockContext")," method."),(0,s.kt)("p",null,"These APIs will be exported directly from ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/fc-starter"),"."),(0,s.kt)("h2",{id:"5-changes-in-deployment-methods"},"5. Changes in deployment methods"),(0,s.kt)("p",null,"Instead of using ",(0,s.kt)("inlineCode",{parentName:"p"},"midway-bin deploy")," for deployment, the platform's own CLI tool will be used. Midway only provides framework and local development capabilities."),(0,s.kt)("p",null,"For more deployment adjustments, please check ",(0,s.kt)("a",{parentName:"p",href:"/docs/serverless/aliyun_faas"},"Pure Function Deployment"),"."))}m.isMDXComponent=!0}}]);