"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[63358],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=i,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(h,a(a({ref:t},p),{},{components:n})):r.createElement(h,a({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:i,a[1]=l;for(var c=2;c<o;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},32265:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=n(87462),i=(n(67294),n(3905));const o={},a="Service and Injection",l={unversionedId:"service",id:"service",title:"Service and Injection",description:"In business, only the code of the controller (Controller) is not enough. Generally speaking, some business logic is abstracted into a specific logical unit, which we generally call the service (Service).",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/service.md",sourceDirName:".",slug:"/service",permalink:"/en/docs/service",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/service.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Application and Context",permalink:"/en/docs/req_res_app"},next:{title:"Exception handling",permalink:"/en/docs/error_filter"}},s={},c=[{value:"Create service",id:"create-service",level:2},{value:"Use service",id:"use-service",level:2},{value:"Injection behavior description",id:"injection-behavior-description",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"service-and-injection"},"Service and Injection"),(0,i.kt)("p",null,"In business, only the code of the controller (Controller) is not enough. Generally speaking, some business logic is abstracted into a specific logical unit, which we generally call the service (Service)."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://img.alicdn.com/imgextra/i2/O1CN01LLV2Qd20Fbu1NWXVA_!!6000000006820-2-tps-2130-344.png",alt:"image.png"})),(0,i.kt)("p",null,"Providing this abstraction has the following benefits:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Keep the logic in the Controller more concise."),(0,i.kt)("li",{parentName:"ul"},"To maintain the independence of business logic, abstract Service can be repeatedly called by multiple Controller."),(0,i.kt)("li",{parentName:"ul"},"Separating logic from presentation makes it easier to write test cases.")),(0,i.kt)("h2",{id:"create-service"},"Create service"),(0,i.kt)("p",null,"In Midway, the common service is a Class. For example, we created a Controller to accept user requests before. We will add a service to process the data."),(0,i.kt)("p",null,"For service files, we usually store them in the ",(0,i.kt)("inlineCode",{parentName:"p"},"src/service")," directory. Let's add a user service."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"\u279c  my_midway_app tree\n.\n\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u251c\u2500\u2500 user.ts\n\u2502   \u2502   \u2514\u2500\u2500 home.ts\n\u2502   \u251c\u2500\u2500 interface.ts\n\u2502   \u2514\u2500\u2500 service\n\u2502       \u2514\u2500\u2500 user.ts\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 tsconfig.json\n")),(0,i.kt)("p",null,"The content is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/service/user.ts\nimport { Provide } from '@midwayjs/core';\n\n@Provide()\nexport class UserService {\n\n  async getUser(id: number) {\n    return {\n      id,\n      name: 'Harry',\n      age: 18,\n    };\n  }\n}\n")),(0,i.kt)("p",null,"Except for an ",(0,i.kt)("inlineCode",{parentName:"p"},"@Provide")," decorator, the structure of the entire service is exactly the same as the ordinary Class, so that's all."),(0,i.kt)("p",null,"We also added a User definition before, which can also be used directly here."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide } from '@midwayjs/core';\nimport { User } from '../interface';\n\n@Provide()\nexport class UserService {\n\n  async getUser(id: number): Promise<User> {\n    return {\n      id,\n      name: 'Harry',\n      age: 18',\n    };\n  }\n}\n")),(0,i.kt)("h2",{id:"use-service"},"Use service"),(0,i.kt)("p",null,"At Controller, we need to call this service. In traditional code writing, we need to initialize this Class(new) and then place the instance where it needs to be called. In Midway, you ",(0,i.kt)("strong",{parentName:"p"},"don't need to do")," this, you just need to write the ",(0,i.kt)("strong",{parentName:"p"},'"dependency injection"')," code we provide."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Inject, Controller, Get, Provide, Query } from '@midwayjs/core';\nimport { UserService } from '../service/user';\n\n@Controller('/api/user')\nexport class APIController {\n\n  @Inject()\n  userService: UserService;\n\n  @Get('/')\n  async getUser(@Query('id') uid) {\n    const user = await this.userService.getUser(uid);\n    return {success: true, message: 'OK', data: user};\n  }\n}\n\n")),(0,i.kt)("p",null,"The process of using the service is divided into several parts:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Use the ",(0,i.kt)("inlineCode",{parentName:"li"},"@Provide")," decorator to expose your service"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li",start:2},(0,i.kt)("li",{parentName:"ol"},"In the code that you call, use the ",(0,i.kt)("inlineCode",{parentName:"li"},"@Inject")," decorator to inject your service."))),(0,i.kt)("li",{parentName:"ul"},"3, call the injection service, execute the corresponding method.")),(0,i.kt)("p",null,'Midway\'s core "dependency injection" container will ',(0,i.kt)("strong",{parentName:"p"},"automatically associate")," your controller (Controller) and service (Service), and all code ",(0,i.kt)("strong",{parentName:"p"},"will be automatically initialized")," during operation. you ",(0,i.kt)("strong",{parentName:"p"},"do not need to manually initialize")," these classes."),(0,i.kt)("h2",{id:"injection-behavior-description"},"Injection behavior description"),(0,i.kt)("p",null,"Seeing here, you will have some doubts as to why there is an ",(0,i.kt)("inlineCode",{parentName:"p"},"@Provide")," decorator on the service (Service), but not on the controller (Controller)."),(0,i.kt)("p",null,"In fact, the controller (Controller) also has this decorator, but in the new version, Controller includes Provide functions. If you are not sure when you can hide it, you can write it all down."),(0,i.kt)("p",null,"If you don't write, the default is equivalent to the following code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"@Provide()\n@Controller('/api/user')\nexport class APIController {\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@Provide")," the role of decorator:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"This Class, hosted by the dependent injection container, will be automatically instantiated (new)"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li",start:2},(0,i.kt)("li",{parentName:"ol"},"This Class can be injected by other Class in the container.")))),(0,i.kt)("p",null,"The corresponding ",(0,i.kt)("inlineCode",{parentName:"p"},"@Inject")," decorator is used:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"In the dependency injection container, find the corresponding attribute name and assign it to the corresponding instantiated object")))),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"In the class of ",(0,i.kt)("inlineCode",{parentName:"p"},"@Inject"),", the corresponding ",(0,i.kt)("inlineCode",{parentName:"p"},"@Provide")," must be valid.")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@Provide")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"@Inject")," decorators appear in pairs, and the two are associated by the class name after the colon."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// service\n@Provide()\nexport class UserService {\n  //...\n}\n\n// controller\n@Provide() // <------ Because there are Controller that include Provide capabilities, the display here is more complete\n@Controller('/api/user')\nexport class APIController {\n\n  @Inject()\n  userService: UserService; // <------ The type here is Class, that is, an instance of this type will be injected\n\n  //...\n}\n\n")),(0,i.kt)("p",null,"This combination will be used in many places. ",(0,i.kt)("strong",{parentName:"p"},"Please remember this usage"),"."),(0,i.kt)("p",null,"Dependency injection is more complex. For more information, see ",(0,i.kt)("a",{parentName:"p",href:"container"},"Dependency injection"),"."))}u.isMDXComponent=!0}}]);