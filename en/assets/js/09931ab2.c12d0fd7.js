"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[52298],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=a.createContext({}),c=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(d.Provider,{value:t},e.children)},s="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),s=c(n),m=r,h=s["".concat(d,".").concat(m)]||s[m]||u[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l[s]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},27635:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={},i=void 0,l={unversionedId:"extensions/code_dye",id:"extensions/code_dye",title:"code_dye",description:"Code-Dye \u4ee3\u7801\u67d3\u8272\u7ec4\u4ef6",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/extensions/code_dye.md",sourceDirName:"extensions",slug:"/extensions/code_dye",permalink:"/en/docs/extensions/code_dye",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/extensions/code_dye.md",tags:[],version:"current",frontMatter:{},sidebar:"component",previous:{title:"JWT",permalink:"/en/docs/extensions/jwt"},next:{title:"Koa",permalink:"/en/docs/extensions/koa"}},d={},c=[{value:"Code-Dye \u4ee3\u7801\u67d3\u8272\u7ec4\u4ef6",id:"code-dye-\u4ee3\u7801\u67d3\u8272\u7ec4\u4ef6",level:2},{value:"Scenes that can be used",id:"scenes-that-can-be-used",level:3},{value:"Effect",id:"effect",level:3},{value:"Install",id:"install",level:3},{value:"configuration",id:"configuration",level:3},{value:"Enable coloring",id:"enable-coloring",level:4},{value:"Dyeing results",id:"dyeing-results",level:4}],p={toc:c},s="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(s,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"code-dye-\u4ee3\u7801\u67d3\u8272\u7ec4\u4ef6"},"Code-Dye \u4ee3\u7801\u67d3\u8272\u7ec4\u4ef6"),(0,r.kt)("p",null,"Code dye components are applicable to ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/faas"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/web"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/koa"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/express")," frameworks."),(0,r.kt)("p",null,"Related information:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Web support"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"@midwayjs/koa"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"@midwayjs/faas"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"@midwayjs/web"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"@midwayjs/express"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")))),(0,r.kt)("h3",{id:"scenes-that-can-be-used"},"Scenes that can be used"),(0,r.kt)("p",null,"Clearly show the time-consuming of calling links and the parameters of each method to help you locate code problems faster.\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Code execution is slow",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"When you don't know which method is slow to execute: after dyeing with code, you can check the ",(0,r.kt)("inlineCode",{parentName:"li"},"execution duration of each method"),"\u3002"))),(0,r.kt)("li",{parentName:"ul"},"Code execution error",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It may be that the method is not tuned: after dyeing with the code, you can view every ",(0,r.kt)("inlineCode",{parentName:"li"},"call chain' of the method"),"\u3002"),(0,r.kt)("li",{parentName:"ul"},"It may be that there is an error in the method call parameter: after dyeing through the code, view each ",(0,r.kt)("inlineCode",{parentName:"li"},"input parameter and return value' of the method"))))),(0,r.kt)("h3",{id:"effect"},"Effect"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gw.alicdn.com/imgextra/i1/O1CN017Zd6y628M2PvqJO7I_!!6000000007917-2-tps-2392-844.png",alt:null})),(0,r.kt)("h3",{id:"install"},"Install"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Installation dependency")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm i @midwayjs/code-dye --save\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Introduce components into configuration")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/configuration.ts\nimport { Configuration } from '@midwayjs/core';\nimport * as codeDye from '@midwayjs/code-dye';\n@Configuration({\n  imports: [\n    // ...\n    {\n      component: codeDye,\n      enabledEnvironment: ['local'],    // Enabled locally only\n    }\n  ],\n})\nexport class MainConfiguration {}\n")),(0,r.kt)("h3",{id:"configuration"},"configuration"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"You can enable this component in the ",(0,r.kt)("inlineCode",{parentName:"li"},"local")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"development")," environment, which is convenient for locating problems during development, but it is ",(0,r.kt)("inlineCode",{parentName:"li"},"not recommended")," to enable it online, which will affect the performance of online access."))),(0,r.kt)("h4",{id:"enable-coloring"},"Enable coloring"),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"matchQueryKey")," configuration to control when the ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," parameter contains the value corresponding to ",(0,r.kt)("inlineCode",{parentName:"p"},"matchQueryKey")," configuration, to enter the dye link, for example, the configuration is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.local.ts\nexport default {\n   codeDye: {\n     matchQueryKey: 'codeDyeABC',\n   }\n}\n")),(0,r.kt)("p",null,"When requesting the interface ",(0,r.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7001/test?codeDyeABC=html"),", it will judge whether ",(0,r.kt)("inlineCode",{parentName:"p"},"codeDyeABC")," parameter exists in ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," to decide whether to dye or not, and respond differently according to the corresponding value of the parameter the staining results."),(0,r.kt)("p",null,"You can also use the ",(0,r.kt)("inlineCode",{parentName:"p"},"matchHeaderKey")," configuration to control when the ",(0,r.kt)("inlineCode",{parentName:"p"},"headers")," parameter contains the value corresponding to the ",(0,r.kt)("inlineCode",{parentName:"p"},"matchHeaderKey")," configuration, to enter the dye link. For example, the configuration is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.local.ts\nexport default {\n   codeDye: {\n     matchHeaderKey: 'codeDyeHeader',\n   }\n}\n")),(0,r.kt)("p",null,"When requesting the interface ",(0,r.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7001/test"),", it will judge whether there is a ",(0,r.kt)("inlineCode",{parentName:"p"},"codeDyeHeader")," parameter in the ",(0,r.kt)("inlineCode",{parentName:"p"},"headers")," of the request to decide whether to dye, and respond to different dyeing according to the corresponding value of the parameter result."),(0,r.kt)("h4",{id:"dyeing-results"},"Dyeing results"),(0,r.kt)("p",null,"After code coloring is enabled, the result of link coloring can be configured by enabling different parameter values for coloring. Currently, the following three types are supported:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"html"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"process")," the result of the current request, add the coloring information to the result, and the response is ",(0,r.kt)("inlineCode",{parentName:"li"},"html"),", which can be viewed on the browser, and the effect can be viewed in the picture above this document."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"json"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"process")," the result of the current request, add coloring information to the result, and respond as ",(0,r.kt)("inlineCode",{parentName:"li"},"json")," structured information."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"log"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"Do not process")," the result of the current request, and the dyed information will be output to the log without affecting the request.")),(0,r.kt)("p",null,"For example, configured as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.local.ts\nexport default {\n   codeDye: {\n     matchQueryKey: 'codeDyeXXX',\n   }\n}\n")),(0,r.kt)("p",null,"When the interface ",(0,r.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7001/test?codeDyeXXX=html")," is requested, it will be judged that the ",(0,r.kt)("inlineCode",{parentName:"p"},"codeDyeXXX")," parameter value in ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"html"),", and the dyeing result will be output in the response of the current request , and the content is in ",(0,r.kt)("inlineCode",{parentName:"p"},"html")," format."))}u.isMDXComponent=!0}}]);