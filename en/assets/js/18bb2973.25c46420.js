"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[76799],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?a.createElement(g,l(l({ref:t},p),{},{components:n})):a.createElement(g,l({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(67294),r=n(86010);const i="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,l),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(87462),r=n(67294),i=n(86010),l=n(72389),o=n(67392),s=n(7094),c=n(12466);const p="tabList__CuJ",d="tabItem_LNqP";function u(e){const{lazy:t,block:n,defaultValue:l,values:u,groupId:m,className:g}=e,h=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),y=u??h.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),f=(0,o.l)(y,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const k=null===l?l:l??h.find((e=>e.props.default))?.props.value??h[0].props.value;if(null!==k&&!y.some((e=>e.value===k)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${k}" but none of its children has the corresponding value. Available values are: ${y.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:b}=(0,s.U)(),[T,w]=(0,r.useState)(k),N=[],{blockElementScrollPositionUntilNextRender:C}=(0,c.o5)();if(null!=m){const e=v[m];null!=e&&e!==T&&y.some((t=>t.value===e))&&w(e)}const x=e=>{const t=e.currentTarget,n=N.indexOf(t),a=y[n].value;a!==T&&(C(t),w(a),null!=m&&b(m,String(a)))},S=e=>{let t=null;switch(e.key){case"Enter":x(e);break;case"ArrowRight":{const n=N.indexOf(e.currentTarget)+1;t=N[n]??N[0];break}case"ArrowLeft":{const n=N.indexOf(e.currentTarget)-1;t=N[n]??N[N.length-1];break}}t?.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",p)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},g)},y.map((e=>{let{value:t,label:n,attributes:l}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:e=>N.push(e),onKeyDown:S,onClick:x},l,{className:(0,i.Z)("tabs__item",d,l?.className,{"tabs__item--active":T===t})}),n??t)}))),t?(0,r.cloneElement)(h.filter((e=>e.props.value===T))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==T})))))}function m(e){const t=(0,l.Z)();return r.createElement(u,(0,a.Z)({key:String(t)},e))}},17673:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var a=n(87462),r=(n(67294),n(3905)),i=n(65488),l=n(85162);const o={},s="Tencent cloud SCF",c={unversionedId:"serverless/tencent_faas",id:"serverless/tencent_faas",title:"Tencent cloud SCF",description:"Serverless Cloud Function (SCF) is a serverless execution environment provided by Tencent Cloud for enterprises and developers to help you run code without purchasing and managing servers. You only need to write the core code in the language supported by the platform and set the conditions under which the code runs to run the code flexibly and safely on the Tencent cloud infrastructure. Cloud functions are ideal computing platforms for real-time file processing and data processing.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/serverless/tencent_faas.md",sourceDirName:"serverless",slug:"/serverless/tencent_faas",permalink:"/en/docs/serverless/tencent_faas",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/tencent_faas.md",tags:[],version:"current",frontMatter:{},sidebar:"serverless",previous:{title:"Aliyun FC",permalink:"/en/docs/serverless/aliyun_faas"},next:{title:"Standard Application Migration Scheme",permalink:"/en/docs/serverless/app_deploy_serverless"}},p={},d=[{value:"Trigger code",id:"trigger-code",level:2},{value:"Local development",id:"local-development",level:2},{value:"Local test",id:"local-test",level:2},{value:"Published to Tencent Cloud SCF",id:"published-to-tencent-cloud-scf",level:2},{value:"Frequently Asked Questions",id:"frequently-asked-questions",level:2},{value:"1. User authentication",id:"1-user-authentication",level:3},{value:"2. Release area switching",id:"2-release-area-switching",level:3},{value:"3. Reuse API Gateway",id:"3-reuse-api-gateway",level:3},{value:"4. Bind domain name",id:"4-bind-domain-name",level:3},{value:"5. Additional Billing",id:"5-additional-billing",level:3},{value:"6. Delete Tencent Cloud Gateway Service",id:"6-delete-tencent-cloud-gateway-service",level:3}],u={toc:d};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"tencent-cloud-scf"},"Tencent cloud SCF"),(0,r.kt)("p",null,"Serverless Cloud Function (SCF) is a serverless execution environment provided by Tencent Cloud for enterprises and developers to help you run code without purchasing and managing servers. You only need to write the core code in the language supported by the platform and set the conditions under which the code runs to run the code flexibly and safely on the Tencent cloud infrastructure. Cloud functions are ideal computing platforms for real-time file processing and data processing."),(0,r.kt)("p",null,"The following are common methods for using and testing function triggers."),(0,r.kt)("h2",{id:"trigger-code"},"Trigger code"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"http",label:"API \u7f51\u5173",mdxType:"TabItem"},(0,r.kt)("p",null,"API Gateway is similar to HTTP functions in Tencent Cloud Function System, through which we publish functions as HTTP services."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloTencentService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.API_GATEWAY, {\n    path: '/api_gateway_tencent',\n    method: 'post',\n  })\n  async handleAPIGatewayEvent(@Body() name) {\n    return 'hello ${name}';\n  }\n}\n")),(0,r.kt)("p",null,"After ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run deploy"),", you can access the link that is output from the console.")),(0,r.kt)(l.Z,{value:"timer",label:"Timer",mdxType:"TabItem"},(0,r.kt)("p",null,"A timed task trigger is used to periodically execute a function. Tencent Cloud Timer Trigger currently only supports cron format."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Warm reminder, please close the trigger in time after testing the function and execute it automatically to avoid over-deduction.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context, SCF } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloTencentService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.TIMER, {\n    type: 'cron',\n    value: '*/60 * * * * * *', // trigger every 60s\n  })\n  async handleTimerEvent(event: SCF.TimerEvent) {\n    this.ctx.logger.info(event);\n    return 'hello world';\n  }\n}\n")),(0,r.kt)("p",null,"Note that Tencent Cloud is set to full Cron. For more information about the Cron format, see ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.tencent.com/document/product/583/9708"},"Development documentation"),"."),(0,r.kt)("p",null,"Common format:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"*/5 * * * * * indicates that it is triggered every 5 seconds.\n0 0 2 1 * * * indicates that it is triggered at 2: 00 a.m. on the 1st of each month.\n0 15 10 * * MON-FRI * means it will be triggered at 10:15 a.m. every day from Monday to Friday.\n0 0 10,14,16 * * * * means to trigger at 10: 00 a.m., 2: 00 p.m. and 4: 00 p.m. every day\n0 */30 9-17 * * * * means every half hour from 9: 00 a.m. to 5: 00 p.m.\n0 0 12 * * WED * means to trigger at 12 noon every Wednesday\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Timer configuration")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attribute name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type"),(0,r.kt)("td",{parentName:"tr",align:null},"cron"),(0,r.kt)("td",{parentName:"tr",align:null},"Required, trigger type, representing cron expression.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"value"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required, cron expression or every value.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"payload"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, a fixed passed value, rarely used")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"cron expression")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(ServerlessTriggerType.TIMER, {\n  type: 'cron',\n  value: '0 0 4 * * *', //triggered at 4:00 every day\n})\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Event structure")),(0,r.kt)("p",null,"The structure returned by the Timer message is as follows and is described in the ",(0,r.kt)("inlineCode",{parentName:"p"},"SCF.TimerEvent")," type."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n  Message: '',\n  Time: new Date().toJSON()\n  TriggerName: 'test',\n  Type: 'Timer',\n}\n"))),(0,r.kt)(l.Z,{value:"cos",label:"COS",mdxType:"TabItem"},(0,r.kt)("p",null,"COS is a service used by Tencent Cloud to store some resource files."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import {\n  Provide\n  Inject\n  ServerlessTrigger\n  ServerlessTriggerType\n} from '@midwayjs/decorator';\nimport { Context, SCF } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloTencentService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType. OS, {\n    bucket: 'cli-appid.cos.ap-beijing.myqcloud.com',\n    events: 'cos:ObjectCreated :*,\n    filter: {\n      prefix: 'filterdir /',\n      suffix: '.jpg',\n    },\n  })\n  async handleCOSEvent(event: SCF.COSEvent) {\n    // xxx\n  }\n}\n")),(0,r.kt)("p",null,"After ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run deploy"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"COS Trigger Configuration")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attribute name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"bucket"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The bucket address of the object store.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"events"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the event that triggered the execution of the function.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Filter"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"prefix: string; ",(0,r.kt)("br",null),"suffix: string;",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"the object filtering parameter. only objects that meet the filtering criteria can trigger the function. it contains a configuration property key, which indicates the object key that the filter supports filtering.")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Listener Object Creation Event")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"  @ServerlessTrigger(ServerlessTriggerType. OS, {\n    bucket: 'cli-appid.cos.ap-beijing.myqcloud.com',\n    events: 'cos:ObjectCreated :*,\n    filter: {\n      prefix: 'filterdir /',\n      suffix: '.jpg',\n    },\n  })\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Event structure")),(0,r.kt)("p",null,"The structure returned by COS messages is as follows, which is described in the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"SCF.COSEvent"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Records": [\n    {\n      "cos": {\n        "cosSchemaVersion": "1.0 ",\n        "cosObject": {\n          "url": "http://testpic-1253970026.cos.ap-chengdu.myqcloud.com/testfile ",\n          "meta": {\n            "x-cos-request-id": "NWMxOWY4MGFfMjViMjU4NjRfMTUyMV8yNzhhZjM =",\n            "Content-Type": ""\n          },\n          "vid": "",\n          "key": "",\n          "size": 1029\n        },\n        "cosBucket": {\n          "region": "cd ",\n          "name": "testpic ",\n          "appid": "1253970026"\n        },\n        "cosNotificationId": "unkown"\n      },\n      "event": {\n        "eventName": "cos:ObjectCreated :*",\n        "eventVersion": "1.0 ",\n        "eventTime": 1545205770\n        "eventSource": "qcs::cos ",\n        "requestParameters": {\n          "requestSourceIP": "192.168.15.101 ",\n          "requestHeaders": {\n            "Authorization": "****************"\n          }\n        },\n        "eventQueue": "qcs:0:lambda:cd:appid/1253970026:default.printevent.$LATEST ",\n        "reservedInfo": "",\n        "reqid": 179398952\n      }\n    }\n  ]\n}\n'))),(0,r.kt)(l.Z,{value:"cmq",label:"CMQ",mdxType:"TabItem"},(0,r.kt)("p",null,"CMQ(mq) triggers subscribe to Tencent Cloud's message queue service."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context, SCF } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloTencentService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.MQ, {\n    topic: 'test-topic',\n    tags: 'bbb',\n  })\n  async handleCMQEvent(event: SCF.CMQEvent) {\n    // xxx\n  }\n}\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note that under Tencent Cloud, the default message queue format provided by midway faas is JSON")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"CMS Trigger Configuration")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attribute name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"topic"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"topic for receiving messages")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tags"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"optional, which describes the tags of message filtering in the subscription (only messages with consistent tags will be pushed)")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Monitor MQ messages")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(ServerlessTriggerType.MQ, {\n  topic: 'test-topic',\n  region: 'cn-shanghai'\n  strategy: 'BACKOFF_RETRY'\n})\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Event structure")),(0,r.kt)("p",null,"The structure returned by CMQ messages is as follows and is described in the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"SCF.CMQEvent"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Records": [\n    {\n      "CMQ": {\n        "type": "topic ",\n        "topicOwner": 1567\n        "topicName": "testtopic ",\n        "subscriptionName": "xxxxxx ",\n        "publishTime": "1970-01-01T00:00:00.000Z ",\n        "msgId": "123345346 ",\n        "requestId": "123345346 ",\n        "msgBody": "Hello from CMQ! ",\n        "msgTag": "tag1,tag2"\n      }\n    }\n  ]\n}\n')))),(0,r.kt)("h2",{id:"local-development"},"Local development"),(0,r.kt)("p",null,"API Gateway types can be developed locally by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run dev")," method similar to traditional applications. Other types of triggers cannot be developed locally by using dev. You can only run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run test")," to run tests."),(0,r.kt)("h2",{id:"local-test"},"Local test"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"http",label:"API \u7f51\u5173",mdxType:"TabItem"},(0,r.kt)("p",null,"Same as the traditional application HTTP test, the function app is created by createFunctionApp and tested by createHttpRequest method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Framework } from '@midwayjs/serverless-app';\nimport { createFunctionApp, createHttpRequest } from '@midwayjs/mock';\n\ndescribe('test/hello_tencent.test.ts', () => {\n  let app: Application;\n  let instance: HelloTencentService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>();\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from http trigger', async () => {\n    const result = await createHttpRequest(app).post('api_gateway_tencent').send({\n      name: 'zhangting',\n    });\n\n    expect(result.text).toEqual('hello zhangting');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"timer",label:"Timer",mdxType:"TabItem"},(0,r.kt)("p",null,"Unlike HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", and the instance of the entire class is obtained by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", thus calling a specific method to test."),(0,r.kt)("p",null,"You can quickly create the structure passed in by the platform by ",(0,r.kt)("inlineCode",{parentName:"p"},"createTimerEvent")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/serverless-app';\nimport { HelloTencentService } from '../src/function/hello_tencent';\nimport { createTimerEvent } from '@midwayjs/serverless-scf-trigger';\nimport { join } from 'path';\n\ndescribe('test/hello_tencent.test.ts', () => {\n  let app: Application;\n  let instance: HelloTencentService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>();\n    instance = await app.getServerlessInstance<HelloTencentService>(HelloTencentService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from timer trigger', async () => {\n    expect(await instance.handleTimerEvent(createTimerEvent())).toEqual('hello world');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"cos",label:"COS",mdxType:"TabItem"},(0,r.kt)("p",null,"Unlike HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", and the instance of the entire class is obtained by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", thus calling a specific method to test."),(0,r.kt)("p",null,"You can quickly create the structure passed in by the platform by ",(0,r.kt)("inlineCode",{parentName:"p"},"createCOSEvent")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/serverless-app';\nimport { HelloTencentService } from '../src/function/hello_tencent';\nimport { createCOSEvent } from '@midwayjs/serverless-scf-trigger';\nimport { join } from 'path';\n\ndescribe('test/hello_tencent.test.ts', () => {\n  let app: Application;\n  let instance: HelloTencentService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>();\n    instance = await app.getServerlessInstance<HelloTencentService>(HelloTencentService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from timer trigger', async () => {\n    expect(await instance.handleCOSEvent(createCOSEvent())).toEqual('hello world');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"cmq",label:"CMQ",mdxType:"TabItem"},(0,r.kt)("p",null,"Unlike HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", and the instance of the entire class is obtained by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", thus calling a specific method to test."),(0,r.kt)("p",null,"You can quickly create the structure passed in by the platform by ",(0,r.kt)("inlineCode",{parentName:"p"},"createCMQEvent")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/serverless-app';\nimport { HelloTencentService } from '../src/function/hello_tencent';\nimport { createCMQEvent } from '@midwayjs/serverless-scf-trigger';\nimport { join } from 'path';\n\ndescribe('test/hello_tencent.test.ts', () => {\n  let app: Application;\n  let instance: HelloTencentService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n    instance = await app.getServerlessInstance<HelloTencentService>(HelloTencentService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from cmq trigger', async () => {\n    expect(await instance.handleCMQEvent(createCMQEvent())).toEqual('hello world');\n  });\n});\n")))),(0,r.kt)("h2",{id:"published-to-tencent-cloud-scf"},"Published to Tencent Cloud SCF"),(0,r.kt)("p",null,"Make sure it is ",(0,r.kt)("inlineCode",{parentName:"p"},"tencent")," at the ",(0,r.kt)("inlineCode",{parentName:"p"},"provider")," paragraph of ",(0,r.kt)("inlineCode",{parentName:"p"},"f.yml")," in the project root directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  name: midway-faas-examples\n\nprovider:\n  name: tencent\n")),(0,r.kt)("p",null,"Configuration runtime"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  name: midway-faas-examples\n\nprovider:\n  name: tencent\n  runtime: nodejs12\n")),(0,r.kt)("p",null,"Configuration function timeout"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  name: midway-faas-examples\n\nprovider:\n  name: tencent\n  Timeout: 60# Unit Seconds\n")),(0,r.kt)("p",null,"Multiplex HTTP gateway"),(0,r.kt)("p",null,"Tencent Cloud will create a new gateway binding every time HTTP type is deployed. For development, we can reuse the same id"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  name: midway-faas-examples\n\nprovider:\n  name: tencent\n  serviceId: ********\n")),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"deploy_tencent_faq#NGqUs"},"DIP"),"."),(0,r.kt)("p",null,"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run deploy"),". The Deploy command is automatically packaged and released by calling the official deployment tool of Tencent Cloud."),(0,r.kt)("p",null,"The video flow is as follows:"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.yuque.com/attachments/yuque/0/2021/mov/501408/1616730670232-05605683-d88e-4e27-a393-9d8f2dfa489f.mov?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2021%2Fmov%2F501408%2F1616730670232-05605683-d88e-4e27-a393-9d8f2dfa489f.mov%22%2C%22name%22%3A%22%E5%B1%8F%E5%B9%95%E5%BD%95%E5%88%B62021-03-25+%E4%B8%8B%E5%8D%884.47.41.mov%22%2C%22size%22%3A19344722%2C%22type%22%3A%22video%2Fquicktime%22%2C%22ext%22%3A%22mov%22%2C%22status%22%3A%22done%22%2C%22uid%22%3A%221616730664011-0%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22percent%22%3A0%2C%22id%22%3A%22dWRP5%22%2C%22card%22%3A%22file%22%7D"},"Screen recording 2021-03-25 pm 4.47.41.mov")),(0,r.kt)("h2",{id:"frequently-asked-questions"},"Frequently Asked Questions"),(0,r.kt)("h3",{id:"1-user-authentication"},"1. User authentication"),(0,r.kt)("p",null,"When Tencent Cloud is deployed, if it is the first deployment, the console will display the corresponding two-dimensional code, and the authentication can be completed by scanning the code. The configuration will be reused by default for a single project."),(0,r.kt)("p",null,"The authentication file is stored in the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in the root directory of the deployment. If you want to modify the file, you can delete the file and scan the code again."),(0,r.kt)("p",null,"You can also modify the content in the following format:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"TENCENT_APP_ID = xxxxxx# AppId of authorized account\nTENCENT_SECRET_ID = xxxxxx# SecretId of authorized account\nTENCENT_SECRET_KEY = xxxxxx# SecretKey of authorized account\nTENCENT_TOKEN = xxxxx# temporary token\n")),(0,r.kt)("p",null,"If you want to use a RAM user to publish a RAM user, you can view the ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.tencent.com/document/product/1154/43006"},"RAM user permissions"),"."),(0,r.kt)("h3",{id:"2-release-area-switching"},"2. Release area switching"),(0,r.kt)("p",null,"Tencent cloud configuration supports publishing to different regions."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service: fc-qinyue-test\n\nprovider:\n  name: tencent\n  runtime: nodejs10\n  region: ap-shanghai\n")),(0,r.kt)("p",null,"Common region values are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ap-shanghai Shanghai"),(0,r.kt)("li",{parentName:"ul"},"ap-guangzhou Guangzhou"),(0,r.kt)("li",{parentName:"ul"},"ap-beijing Beijing"),(0,r.kt)("li",{parentName:"ul"},"ap-hongkong Hong Kong")),(0,r.kt)("p",null,"For the complete list of regions, see ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.tencent.com/document/api/583/17238"},"Tencent Cloud documentation"),"."),(0,r.kt)("h3",{id:"3-reuse-api-gateway"},"3. Reuse API Gateway"),(0,r.kt)("p",null,"If the HTTP function is officially released, Tencent Cloud will automatically create a serviceId that identifies the Gateway every time it is released, and there will be many in the long run. In order to reuse each time, it is better to record the serviceId to reuse the following codes after the first release (or apply for a good gateway in advance)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service: fc-qinyue-test\n\nprovider:\n  name: tencent\n  runtime: nodejs10\n  serviceId: service-xxxxxx # <---- fill in the id here for reuse\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Obtain the ID of the API Gateway")),(0,r.kt)("p",null,"Way one, get from the platform."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588752561344-c520ce4d-8dba-4e88-99c6-744e5af73cb9.png#height=577&id=nPqm4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=577&originWidth=1173&originalType=binary&size=72901&status=done&style=none&width=1173",width:"1173"}),(0,r.kt)("p",null,"Method 2, get after each release."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588752629863-178fd9db-7dcb-496e-af05-1fc68abfb30f.png#height=115&id=iBgEU&margin=%5Bobject%20Object%5D&name=image.png&originHeight=115&originWidth=746&originalType=binary&size=39588&status=done&style=none&width=746",width:"746"}),(0,r.kt)("h3",{id:"4-bind-domain-name"},"4. Bind domain name"),(0,r.kt)("p",null,"After Tencent Cloud is released, it automatically gives a gateway address to access cloud functions, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"http:// service-xxxxx-xxxxxxxx.gz.apigw.tencentcs.com:80"),". At the same time, it automatically maps three sets of environment names and loads them on the path."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Test environment/test"),(0,r.kt)("li",{parentName:"ul"},"Advance/prepub"),(0,r.kt)("li",{parentName:"ul"},"Online/release")),(0,r.kt)("p",null,"This address can be seen at both the trigger management of the function and the API gateway."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588752924557-d0eb153e-f583-49c2-b9a4-55e417867b43.png#height=421&id=cPfTl&margin=%5Bobject%20Object%5D&name=image.png&originHeight=578&originWidth=1025&originalType=binary&size=49631&status=done&style=none&width=746",width:"746"}),(0,r.kt)("p",null,"at the gateway."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588752972052-c2f7fbc8-0725-49e0-ab73-5dec6a7c0c00.png#height=732&id=Qw18W&margin=%5Bobject%20Object%5D&name=image.png&originHeight=732&originWidth=3010&originalType=binary&size=238685&status=done&style=none&width=3010",width:"3010"}),(0,r.kt)("p",null,"If we want to remove this environment, we have to bind a custom domain name."),(0,r.kt)("p",null,'Click "New" at the custom domain name of API Gateway ".'),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588753063041-496d876f-3457-47cb-8156-c9e8364e91db.png#height=338&id=mIiB5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=338&originWidth=1096&originalType=binary&size=26777&status=done&style=none&width=1096",width:"1096"}),(0,r.kt)("p",null,"Configure a custom path mapping, such as mapping",(0,r.kt)("inlineCode",{parentName:"p"},"/"),"to the official publishing environment, so that the environment suffix is not required when accessing by a domain name."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588753124170-9e6a2b01-dad8-47df-9d81-294d8397137b.png#height=607&id=FAbTy&margin=%5Bobject%20Object%5D&name=image.png&originHeight=607&originWidth=904&originalType=binary&size=49449&status=done&style=none&width=904",width:"904"}),(0,r.kt)("h3",{id:"5-additional-billing"},"5. Additional Billing"),(0,r.kt)("p",null,"When using local tools, due to the SDK provided by Tencent Cloud, a COS Bucket may be created for the storage of code packages. As COS is used for payment, a certain fee will be incurred. Please pay attention to your COS situation in time to avoid deduction."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1606803155279-51e71ffa-6e9a-4ab9-812b-19003d45483c.png#height=460&id=DRD5n&margin=%5Bobject%20Object%5D&name=image.png&originHeight=460&originWidth=1196&originalType=binary&size=60856&status=done&style=none&width=1196",width:"1196"}),(0,r.kt)("h3",{id:"6-delete-tencent-cloud-gateway-service"},"6. Delete Tencent Cloud Gateway Service"),(0,r.kt)("p",null,"After trying out the Tencent cloud service for a period of time, many examples of non-reused gateways will appear because API gateways are not reused every time, as follows."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588749300990-34089754-5fe2-4fb9-942a-0f9f0abc6984.png#height=1226&id=Jo9cX&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1226&originWidth=2778&originalType=binary&size=261243&status=done&style=none&width=2778",width:"2778"}),(0,r.kt)("p",null,"At this time, because the gateway has bound functions, the delete button is gray, and we need to manually delete the resources one by one."),(0,r.kt)("p",null,"Enter an API gateway instance first."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588749368951-da40aa66-249f-46ac-b208-e7085952c528.png#height=361&id=fA0yx&margin=%5Bobject%20Object%5D&name=image.png&originHeight=942&originWidth=1946&originalType=binary&size=134710&status=done&style=none&width=746",width:"746"}),(0,r.kt)("p",null,"Enter the management API and delete the general API below."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588749549259-fd35cfa1-9e00-42a3-82ff-78f3de23dd85.png#height=930&id=iTseJ&margin=%5Bobject%20Object%5D&name=image.png&originHeight=930&originWidth=2346&originalType=binary&size=122962&status=done&style=none&width=2346",width:"2346"}),(0,r.kt)("p",null,"Go to environmental management and take the environment offline."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588749641386-77ddf012-2b29-46a5-a8dc-6d416d07518e.png#height=770&id=lAclZ&margin=%5Bobject%20Object%5D&name=image.png&originHeight=770&originWidth=2234&originalType=binary&size=134714&status=done&style=none&width=2234",width:"2234"}),(0,r.kt)("p",null,"Go back to the initial list and click Delete."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588749709595-1c47d6e3-08af-42e1-be34-961409f82e1a.png#height=986&id=ZpugG&margin=%5Bobject%20Object%5D&name=image.png&originHeight=986&originWidth=2342&originalType=binary&size=182531&status=done&style=none&width=2342",width:"2342"}))}m.isMDXComponent=!0}}]);