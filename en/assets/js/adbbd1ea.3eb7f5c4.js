"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[69334],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>u});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=o.createContext({}),d=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=d(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),m=d(n),u=i,f=m["".concat(s,".").concat(u)]||m[u]||p[u]||r;return n?o.createElement(f,a(a({ref:t},l),{},{components:n})):o.createElement(f,a({ref:t},l))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:i,a[1]=c;for(var d=2;d<r;d++)a[d]=n[d];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},58907:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var o=n(87462),i=(n(67294),n(3905));const r={},a="Extended context definition",c={unversionedId:"context_definition",id:"context_definition",title:"Extended context definition",description:"Due to static type analysis of TS, we do not recommend dynamically mounting certain attributes. Dynamic mounting will make it very difficult to process TS types. In some special scenarios, if you need to extend the context ctx attribute, such as the middleware in the Web scenario, we can add some methods or attributes.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/context_definition.md",sourceDirName:".",slug:"/context_definition",permalink:"/en/docs/context_definition",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/context_definition.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Retryable",permalink:"/en/docs/retry"},next:{title:"Custom component",permalink:"/en/docs/component_development"}},s={},d=[{value:"Extended definition in project",id:"extended-definition-in-project",level:2},{value:"Extension definition in component",id:"extension-definition-in-component",level:2}],l={toc:d};function p(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"extended-context-definition"},"Extended context definition"),(0,i.kt)("p",null,"Due to static type analysis of TS, we do not recommend dynamically mounting certain attributes. Dynamic mounting will make it very difficult to process TS types. In some special scenarios, if you need to extend the context ctx attribute, such as the middleware in the Web scenario, we can add some methods or attributes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Middleware } from '@midwayjs/decorator';\nimport { Context } from '@midwayjs/koa';\n\n@Middleware()\nexport class ReportMiddleware implements IWebMiddleware {\n\n  resolve() {\n    return async (ctx: Context, next) => {\n\n      ctx.abc = '123';\n      await next();\n\n    }\n  }\n\n}\n")),(0,i.kt)("p",null,"However, due to the relationship between TypeScript module definitions, we cannot attach definitions to existing modules, so we used a new method to expand."),(0,i.kt)("h2",{id:"extended-definition-in-project"},"Extended definition in project"),(0,i.kt)("p",null,"You can extend Midway's common Context in the project through the following code in ",(0,i.kt)("inlineCode",{parentName:"p"},"src/interface.ts"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/interface.ts\n\nimport '@midwayjs/core';\n\n// ...\n\ndeclare module '@midwayjs/core'{\n  interface Context {\n    abc: string;\n  }\n}\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Note that ",(0,i.kt)("inlineCode",{parentName:"p"},"declare module")," replaces the original definition, so please import the module using ",(0,i.kt)("inlineCode",{parentName:"p"},"import")," syntax before operating.")),(0,i.kt)("h2",{id:"extension-definition-in-component"},"Extension definition in component"),(0,i.kt)("p",null,"Components are slightly different. Generally speaking, components may only be used in specific scenarios."),(0,i.kt)("p",null,"You can extend Midway's common Context through the following code in ",(0,i.kt)("inlineCode",{parentName:"p"},"index.d.ts")," of the component root directory."),(0,i.kt)("p",null,"If you want to expand the Context of all scenes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// index.d.ts\n\n// The following paragraph can extend all Context\ndeclare module '@midwayjs/core/dist/interface '{\n  interface Context {\n    abc: string;\n  }\n}\n")),(0,i.kt)("p",null,"If you only want to expand the Context of a specific scene."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// index.d.ts\n\n// The following paragraph is only extended by the Context of @midwayjs/koa\ndeclare module '@midwayjs/koa/dist/interface '{\n  interface Context {\n    abc: string;\n  }\n}\n\n// The following paragraph is only extended by @midwayjs/Web Context\ndeclare module '@midwayjs/web/dist/interface '{\n  interface Context {\n    abc: string;\n  }\n}\n\n// The following paragraph is only extended by the Context of @midwayjs/faas\ndeclare module '@midwayjs/faas/dist/interface '{\n  interface Context {\n    abc: string;\n  }\n}\n\n// The following paragraph is only extended by @midwayjs/express Context\ndeclare module '@midwayjs/express/dist/interface '{\n  interface Context {\n    abc: string;\n  }\n}\n\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"The extension in the component is slightly different from that in the project (it is suspected to be a bug of TS)."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("ol",{parentName:"li",start:2},(0,i.kt)("li",{parentName:"ol"},"If the extension method of the project is used in the component, there will be problems with the extension prompts of the remaining components."))))))}p.isMDXComponent=!0}}]);