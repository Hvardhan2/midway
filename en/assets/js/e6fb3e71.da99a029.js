"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3825],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(g,l(l({ref:t},c),{},{components:n})):a.createElement(g,l({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(67294),r=n(86010);const i="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,l),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(87462),r=n(67294),i=n(86010),l=n(72389),o=n(67392),s=n(7094),p=n(12466);const c="tabList__CuJ",u="tabItem_LNqP";function d(e){const{lazy:t,block:n,defaultValue:l,values:d,groupId:m,className:g}=e,h=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),y=d??h.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),f=(0,o.l)(y,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const k=null===l?l:l??h.find((e=>e.props.default))?.props.value??h[0].props.value;if(null!==k&&!y.some((e=>e.value===k)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${k}" but none of its children has the corresponding value. Available values are: ${y.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:b,setTabGroupChoices:v}=(0,s.U)(),[N,T]=(0,r.useState)(k),w=[],{blockElementScrollPositionUntilNextRender:C}=(0,p.o5)();if(null!=m){const e=b[m];null!=e&&e!==N&&y.some((t=>t.value===e))&&T(e)}const S=e=>{const t=e.currentTarget,n=w.indexOf(t),a=y[n].value;a!==N&&(C(t),T(a),null!=m&&v(m,String(a)))},A=e=>{let t=null;switch(e.key){case"Enter":S(e);break;case"ArrowRight":{const n=w.indexOf(e.currentTarget)+1;t=w[n]??w[0];break}case"ArrowLeft":{const n=w.indexOf(e.currentTarget)-1;t=w[n]??w[w.length-1];break}}t?.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",c)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},g)},y.map((e=>{let{value:t,label:n,attributes:l}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>w.push(e),onKeyDown:A,onClick:S},l,{className:(0,i.Z)("tabs__item",u,l?.className,{"tabs__item--active":N===t})}),n??t)}))),t?(0,r.cloneElement)(h.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function m(e){const t=(0,l.Z)();return r.createElement(d,(0,a.Z)({key:String(t)},e))}},62485:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>p,toc:()=>u});var a=n(87462),r=(n(67294),n(3905)),i=n(65488),l=n(85162);const o={},s="Aliyun FC",p={unversionedId:"serverless/aliyun_faas",id:"serverless/aliyun_faas",title:"Aliyun FC",description:"Alibaba Cloud Serverless is one of the first teams in China to provide Serverless computing services. Relying on Alibaba Cloud's powerful cloud infrastructure service capabilities, Alibaba Cloud continues to achieve technological breakthroughs. At present, Taobao, Alipay, DingTalk, Gaud and other enterprises have applied Serverless to the production business. Serverless products on the cloud have successfully landed in tens of thousands of enterprises such as pumpkin movies, Netease Cloud Music, iQiyi sports and Lilith.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/serverless/aliyun_faas.md",sourceDirName:"serverless",slug:"/serverless/aliyun_faas",permalink:"/en/docs/serverless/aliyun_faas",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/aliyun_faas.md",tags:[],version:"current",frontMatter:{},sidebar:"serverless",previous:{title:"Default error behavior",permalink:"/en/docs/serverless/serverless_error"},next:{title:"Tencent cloud SCF",permalink:"/en/docs/serverless/tencent_faas"}},c={},u=[{value:"Trigger code",id:"trigger-code",level:2},{value:"Local development",id:"local-development",level:2},{value:"Local test",id:"local-test",level:2},{value:"publish to alibaba cloud",id:"publish-to-alibaba-cloud",level:2},{value:"Frequently Asked Questions",id:"frequently-asked-questions",level:2},{value:"1. Custom domain name",id:"1-custom-domain-name",level:3},{value:"2. Some restrictions on http headers",id:"2-some-restrictions-on-http-headers",level:3},{value:"3. The size of the release package",id:"3-the-size-of-the-release-package",level:3},{value:"4. Container time zone problem",id:"4-container-time-zone-problem",level:3},{value:"5. Revised AccessKey",id:"5-revised-accesskey",level:3},{value:"6. CLI Releases Red Tips",id:"6-cli-releases-red-tips",level:3},{value:"7. Specify accessKey at the time of release, etc.",id:"7-specify-accesskey-at-the-time-of-release-etc",level:3},{value:"8. Release Timeout",id:"8-release-timeout",level:3}],d={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"aliyun-fc"},"Aliyun FC"),(0,r.kt)("p",null,"Alibaba Cloud Serverless is one of the first teams in China to provide Serverless computing services. Relying on Alibaba Cloud's powerful cloud infrastructure service capabilities, Alibaba Cloud continues to achieve technological breakthroughs. At present, Taobao, Alipay, DingTalk, Gaud and other enterprises have applied Serverless to the production business. Serverless products on the cloud have successfully landed in tens of thousands of enterprises such as pumpkin movies, Netease Cloud Music, iQiyi sports and Lilith."),(0,r.kt)("p",null,"Alibaba Cloud Serverless includes many products, such as Function Compute FC and Lightweight Application Engine SAE. This article mainly uses its ",(0,r.kt)("strong",{parentName:"p"},"Function Compute")," part."),(0,r.kt)("p",null,"The following are common methods for using and testing function triggers."),(0,r.kt)("h2",{id:"trigger-code"},"Trigger code"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"event",label:"Event",mdxType:"TabItem"},(0,r.kt)("p",null,"Publish functions that do not contain triggers. This is the simplest type. You can manually trigger parameters directly through event or bind other triggers on the platform."),(0,r.kt)("p",null,"Bind the event trigger by ",(0,r.kt)("inlineCode",{parentName:"p"},"@ServerlessTrigger")," the decorator directly in the code."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context, FC } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloAliyunService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.EVENT)\n  async handleEvent(event: any) {\n    return event;\n  }\n}\n"))),(0,r.kt)(l.Z,{value:"http",label:"HTTP",mdxType:"TabItem"},(0,r.kt)("p",null,"Alibaba Cloud's HTTP triggers are different from other platforms. They are another set of triggers that are independent of API Gateway and serve HTTP scenarios. Compared with API gateway, this trigger is easier to use and configure."),(0,r.kt)("p",null,"Bind HTTP triggers by ",(0,r.kt)("inlineCode",{parentName:"p"},"@ServerlessTrigger")," decorators directly in code."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloAliyunService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.HTTP, {\n    path: '/',\n    method: 'get',\n  })\n  async handleHTTPEvent(@Query() name = 'midway') {\n    return 'hello ${name}';\n  }\n}\n"))),(0,r.kt)(l.Z,{value:"apigw",label:"API \u7f51\u5173",mdxType:"TabItem"},(0,r.kt)("p",null,"API Gateway is special in the Alibaba Cloud function system. It is similar to creating a trigger-free function that is bound to a specific path through the platform gateway."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloAliyunService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.API_GATEWAY, {\n    path: '/api_gateway_aliyun',\n    method: 'post',\n  })\n  async handleAPIGatewayEvent(@Body() name) {\n    return 'hello ${name}';\n  }\n}\n")),(0,r.kt)("p",null,"After ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run deploy"),", see ",(0,r.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/74798.html?spm=a2c4g.11186623.6.701.3be978a1MKsNN4"},"Alibaba Cloud documentation"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The route on the current API gateway is configured on the platform."))),(0,r.kt)(l.Z,{value:"timer",label:"Timer",mdxType:"TabItem"},(0,r.kt)("p",null,"A timed task trigger is used to periodically execute a function. There are two ways of timing, every time and cron format."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Warm reminder, please close the trigger in time after testing the function and execute it automatically to avoid over-deduction.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context, FC } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloAliyunService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.TIMER, {\n    type: 'cron',\n    value: '0 0 4 * * *', // trigger https://help.aliyun.com/document_detail/68172.html at 4:00 every day\n  })\n  async handleTimerEvent(event: FC.TimerEvent) {\n    this.ctx.logger.info(event);\n    return 'hello world';\n  }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Timer configuration")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attribute name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cron")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"every"),", which is required. The trigger type represents a cron expression at a fixed time interval.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"value"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Required, cron expression or every value. At every time, the minimum time interval is 1 minute, fixed unit minute.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"payload"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, a fixed passed value, rarely used")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note that FC uses UTC time, which is different from the traditional Chinese time zone.")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"cron expression")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(ServerlessTriggerType.TIMER, {\n  type: 'cron',\n  value: '0 0 4 * * *', //triggered at 4:00 every day\n})\n")),(0,r.kt)("p",null,"You can view the ",(0,r.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/169784.html"},"documentation")," of the cron expression."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"every expression")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(ServerlessTriggerType.TIMER, {\n  type: 'every',\n  value: '5m', // every 5 minutes, minimum 1 minute\n})\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Event structure")),(0,r.kt)("p",null,"The structure returned by the Timer message is as follows, described in the ",(0,r.kt)("inlineCode",{parentName:"p"},"FC.TimerEvent")," type."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n  triggerTime: new Date().toJSON()\n  triggerName: 'timer',\n  payload: '',\n}\n"))),(0,r.kt)(l.Z,{value:"oss",label:"OSS",mdxType:"TabItem"},(0,r.kt)("p",null,"OSS is used to store some resource files and is a resource storage product of Alibaba Cloud.  When a file is created and updated in OSS, the corresponding function will be triggered and executed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context, FC } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloAliyunService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType. OS, {\n    bucket: 'ossBucketName',\n    events: ['oss:ObjectCreated:*', 'oss:ObjectRemoved:DeleteObject'],\n    filter: {\n      prefix: 'filterdir /',\n      suffix: '.jpg',\n    },\n  })\n  async handleOSSEvent(event: FC.OSSEvent) {\n    // xxx\n  }\n}\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Only one trigger can be configured under one prefix of a bucket. If multiple triggers are configured, the ",(0,r.kt)("inlineCode",{parentName:"p"},"message: event source'oss' returned error: Canot specify overlapping prefix and suffix with same event type will appear.")," The error")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"OSS Trigger Configuration")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attribute name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"bucket"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The bucket name of the object store.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"events"),(0,r.kt)("td",{parentName:"tr",align:null},"string []"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the event that triggered the execution of the function.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Filter"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"prefix: string; ",(0,r.kt)("br",null),"suffix: string;",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"the object filtering parameter. only objects that meet the filtering criteria can trigger the function. it contains a configuration property key, which indicates the object key that the filter supports filtering.")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Listener events during object creation and object deletion")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(ServerlessTriggerType. OS, {\n  bucket: 'ossBucketName',\n  events: ['oss:ObjectCreated:*', 'oss:ObjectRemoved:DeleteObject']\n  filter: {\n    prefix: 'filterdir /',\n    suffix: '.jpg',\n  },\n})\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Event structure")),(0,r.kt)("p",null,"The structure of OSS messages returned is as follows, which is described in the ",(0,r.kt)("inlineCode",{parentName:"p"},"FC.OSSEvent")," type."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "events": [\n    {\n      "eventName": "ObjectCreated:PutObject ",\n      "eventSource": "acs:oss ",\n      "eventTime": "2017-04-21T12:46:37.000Z ",\n      "eventVersion": "1.0 ",\n      "oss": {\n        "bucket": {\n          "arn": "acs:oss:cn-shanghai:123456789:bucketname ",\n          "name": "testbucket ",\n          "ownerIdentity": "123456789 ",\n          "virtualBucket": ""\n        },\n        "object": {\n          "deltaSize": 122539\n          "eTag": "688A7BF4F233DC9C88A80BF985AB7329 ",\n          "key": "image/a.jpg ",\n          "size": 122539\n        },\n        "ossSchemaVersion": "1.0 ",\n        "ruleId": "9adac8e253828f4f7c0466d941fa3db81161e853"\n      },\n      "region": "cn-shanghai ",\n      "requestParameters": {\n        "sourceIPAddress": "140.205.128.221"\n      },\n      "responseElements": {\n        "requestId": "58F9FF2D3DF792092E12044C"\n      },\n      "userIdentity": {\n        "principalId": "123456789"\n      }\n    }\n  ]\n}\n'))),(0,r.kt)(l.Z,{value:"mns",label:"MNS",mdxType:"TabItem"},(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Please note that Alibaba Cloud Message Queue will incur certain fees for Topic and Queue.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, ServerlessTrigger, ServerlessTriggerType } from '@midwayjs/decorator';\nimport { Context, FC } from '@midwayjs/faas';\n\n@Provide()\nexport class HelloAliyunService {\n  @Inject()\n  ctx: Context;\n\n  @ServerlessTrigger(ServerlessTriggerType.MQ, {\n    topic: 'test-topic',\n    tags: 'bbb',\n  })\n  async handleMNSEvent(event: FC.MNSEvent) {\n    // ...\n  }\n}\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note that under Alibaba Cloud, the default message queue format provided by midway faas is JSON.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Configure an MNS trigger")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attribute name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"topic"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"topic for receiving messages")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tags"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"optional, which describes the tags of message filtering in the subscription (only messages with consistent tags will be pushed)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"strategy"),(0,r.kt)("td",{parentName:"tr",align:null},'"BACKOFF_RETRY" ',"|"," \"EXPONENTIAL_DECAY_RETRY'"),(0,r.kt)("td",{parentName:"tr",align:null},"Retry policy for calling function, optional value: BACKOFF_RETRY, EXPONENTIAL_DECAY_RETRY, default value: BACKOFF_RETRY")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"region"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"optional. the region where the topic is located. if not, the default is the same region as the function.")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Monitor MQ messages")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@ServerlessTrigger(ServerlessTriggerType.MQ, {\n  topic: 'test-topic',\n  region: 'cn-shanghai'\n  strategy: 'BACKOFF_RETRY'\n})\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Event structure")),(0,r.kt)("p",null,"The structure returned by MNS messages is as follows, which is described in the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"FC.MNSEvent"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Context": "user custom info ",\n  "TopicOwner": "1186202104331798 ",\n  "Message": "hello topic ",\n  "Subscriber": "1186202104331798 ",\n  "PublishTime": 1550216302888\n  "SubscriptionName": "test-fc-subscibe ",\n  "MessageMD5": "BA4BA9B48AC81F0F9C66F6C909C39DBB",\n  "TopicName": "test-topic ",\n  "MessageId": "2F5B3C281B283D4EAC694B7425288675"\n}\n')))),(0,r.kt)("h2",{id:"local-development"},"Local development"),(0,r.kt)("p",null,"HTTP triggers and API Gateway types can be developed locally by using local ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run dev")," and similar development methods to traditional applications. Other types of triggers cannot be developed locally by using dev. They can only be tested and executed by running ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run test"),"."),(0,r.kt)("h2",{id:"local-test"},"Local test"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"event",label:"Event",mdxType:"TabItem"},(0,r.kt)("p",null,"Create a function app by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", obtain a class instance by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", and then directly call the method of the instance to pass in parameters for testing."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"describe('test/hello_aliyun.test.ts', () => {\n  let app: Application;\n  let instance: HelloAliyunService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n    instance = await app.getServerlessInstance<HelloAliyunService>(HelloAliyunService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from event trigger', async () => {\n    expect(await instance.handleEvent('hello world')).toEqual('hello world');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"http",label:"HTTP",mdxType:"TabItem"},(0,r.kt)("p",null,"Similar to the application, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp")," and tested by ",(0,r.kt)("inlineCode",{parentName:"p"},"createHttpRequest")," method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Framework } from '@midwayjs/serverless-app';\nimport { createInitializeContext } from '@midwayjs/serverless-fc-trigger';\nimport { createFunctionApp, createHttpRequest } from '@midwayjs/mock';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n  let app: Application;\n  let instance: HelloAliyunService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from http trigger', async () => {\n    const result = await createHttpRequest(app).get('/').query({\n      name: 'zhangting',\n    });\n    expect(result.text).toEqual('hello zhangting');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"apigw",label:"API \u7f51\u5173",mdxType:"TabItem"},(0,r.kt)("p",null,"Same as HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp")," and tested by ",(0,r.kt)("inlineCode",{parentName:"p"},"createHttpRequest")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Framework } from '@midwayjs/serverless-app';\nimport { createInitializeContext } from '@midwayjs/serverless-fc-trigger';\nimport { createFunctionApp, createHttpRequest } from '@midwayjs/mock';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n  let app: Application;\n  let instance: HelloAliyunService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from http trigger', async () => {\n    const result = await createHttpRequest(app).post('api_gateway_aliyun').send({\n      name: 'zhangting',\n    });\n\n    expect(result.text).toEqual('hello zhangting');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"timer",label:"Timer",mdxType:"TabItem"},(0,r.kt)("p",null,"Unlike HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", and the instance of the entire class is obtained by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", thus calling a specific method to test."),(0,r.kt)("p",null,"You can quickly create the structure passed in by the platform by ",(0,r.kt)("inlineCode",{parentName:"p"},"createTimerEvent")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/serverless-app';\nimport { HelloAliyunService } from '../src/function/hello_aliyun';\nimport { createTimerEvent, createInitializeContext } from '@midwayjs/serverless-fc-trigger';\nimport { join } from 'path';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n  let app: Application;\n  let instance: HelloAliyunService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n    instance = await app.getServerlessInstance<HelloAliyunService>(HelloAliyunService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from timer trigger', async () => {\n    expect(await instance.handleTimerEvent(createTimerEvent())).toEqual('hello world');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"oss",label:"OSS",mdxType:"TabItem"},(0,r.kt)("p",null,"Unlike HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", and the instance of the entire class is obtained by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", thus calling a specific method to test."),(0,r.kt)("p",null,"You can quickly create the structure passed in by the platform by ",(0,r.kt)("inlineCode",{parentName:"p"},"createOSSEvent")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/serverless-app';\nimport { HelloAliyunService } from '../src/function/hello_aliyun';\nimport { createOSSEvent, createInitializeContext } from '@midwayjs/serverless-fc-trigger';\nimport { join } from 'path';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n  let app: Application;\n  let instance: HelloAliyunService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n    instance = await app.getServerlessInstance<HelloAliyunService>(HelloAliyunService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from oss trigger', async () => {\n    expect(await instance.handleOSSEvent(createOSSEvent())).toEqual('hello world');\n  });\n});\n"))),(0,r.kt)(l.Z,{value:"mns",label:"MNS",mdxType:"TabItem"},(0,r.kt)("p",null,"Unlike HTTP testing, the function app is created by ",(0,r.kt)("inlineCode",{parentName:"p"},"createFunctionApp"),", and the instance of the entire class is obtained by ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerlessInstance"),", thus calling a specific method to test."),(0,r.kt)("p",null,"You can quickly create the structure passed in by the platform by ",(0,r.kt)("inlineCode",{parentName:"p"},"createMNSEvent")," methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createFunctionApp, close } from '@midwayjs/mock';\nimport { Framework, Application } from '@midwayjs/serverless-app';\nimport { HelloAliyunService } from '../src/function/hello_aliyun';\nimport { createMNSEvent, createInitializeContext } from '@midwayjs/serverless-fc-trigger';\nimport { join } from 'path';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n  let app: Application;\n  let instance: HelloAliyunService;\n\n  beforeAll(async () => {\n    // create app\n    app = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: createInitializeContext()\n    });\n    instance = await app.getServerlessInstance<HelloAliyunService>(HelloAliyunService);\n  });\n\n  afterAll(async () => {\n    await close(app);\n  });\n\n  it('should get result from oss trigger', async () => {\n    expect(await instance.handleMNSEvent(createMNSEvent())).toEqual('hello world');\n  });\n});\n")))),(0,r.kt)("h2",{id:"publish-to-alibaba-cloud"},"publish to alibaba cloud"),(0,r.kt)("p",null,"Ensure ",(0,r.kt)("inlineCode",{parentName:"p"},"aliyun")," at the ",(0,r.kt)("inlineCode",{parentName:"p"},"provider")," paragraph of ",(0,r.kt)("inlineCode",{parentName:"p"},"f.yml")," in the project root directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  name: midway-faas-examples\n\nprovider:\n  name: aliyun\n")),(0,r.kt)("p",null,"Deploy the function. You can directly use the release command to package and deploy the function. The Deploy command is automatically packaged and released by calling the official deployment tool of Alibaba Cloud."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ npm run deploy\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you enter the wrong information, you can re-execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"npx midway-bin deploy -- resetConfig")," modification.")),(0,r.kt)("p",null,"For the first time, Alibaba Cloud deployment needs to configure ",(0,r.kt)("inlineCode",{parentName:"p"},"accountId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"accountKey"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"accountSecret"),"."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1585718654967-11e1bcbd-5a56-4239-99e1-5a1472ad49fd.png#align=left&display=inline&height=514&margin=%5Bobject%20Object%5D&originHeight=514&originWidth=1152&size=0&status=done&style=none&width=1152",width:"1152"}),(0,r.kt)("p",null,"For related configuration, please refer to the picture below:"),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1585718654949-9c14958c-3aff-403a-b89b-d03a3a95cd18.png#align=left&display=inline&height=696&margin=%5Bobject%20Object%5D&originHeight=696&originWidth=1832&size=0&status=done&style=none&width=1832",width:"1832"}),(0,r.kt)("p",null,"Click ",(0,r.kt)("a",{parentName:"p",href:"https://account.console.aliyun.com/#/secure"},"Security Settings"),"."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1585718654950-19a811c5-2cf3-4843-a619-cfd744430fae.png#align=left&display=inline&height=184&margin=%5Bobject%20Object%5D&originHeight=592&originWidth=2406&size=0&status=done&style=none&width=746",width:"746"}),(0,r.kt)("p",null,"Click the ",(0,r.kt)("a",{parentName:"p",href:"https://usercenter.console.aliyun.com/#/manage/ak"},"AccessKey page")," of Alibaba Cloud."),(0,r.kt)("p",null,"Here is an example of an http trigger."),(0,r.kt)("p",null,"After the release, Alibaba Cloud will output a temporarily available domain name and open the browser to access it."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1600835297676-1753de7a-fb0d-46ca-98f0-944eba5b2f2b.png#align=left&display=inline&height=193&margin=%5Bobject%20Object%5D&name=image.png&originHeight=193&originWidth=1219&size=35152&status=done&style=none&width=1219",width:"1219"}),(0,r.kt)("p",null,"After the release is completed, the platform status is as follows."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1586685106514-c52880d4-c447-4bc1-9b8b-6db99dd81878.png#height=436&id=wtVSC&margin=%5Bobject%20Object%5D&name=image.png&originHeight=872&originWidth=2684&originalType=binary&size=164942&status=done&style=none&width=1342",width:"1342"}),(0,r.kt)("p",null,"release effect, each configured function will be published as a function on the platform, and the http trigger will be automatically configured."),(0,r.kt)("h2",{id:"frequently-asked-questions"},"Frequently Asked Questions"),(0,r.kt)("h3",{id:"1-custom-domain-name"},"1. Custom domain name"),(0,r.kt)("p",null,"You need to apply for a domain name in advance. If you are in China, you need to file it, otherwise you cannot bind it."),(0,r.kt)("p",null,"The first step is to turn off the function of the default automatically generated domain name"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  name: midway-faas-examples\n\nprovider:\n  name: aliyun\n\ncustom:\n  customDomain: false\n")),(0,r.kt)("p",null,"The second step is to add domain name resolution to the gateway corresponding to your function."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588654519449-2c98a9d8-ffac-42b7-bcf2-ac19c21f08ac.png#height=478&id=kmxTj&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1090&originWidth=1700&originalType=binary&size=132002&status=done&style=none&width=746",width:"746"}),(0,r.kt)("p",null,"Bind a custom domain name on the function page and add a route"),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1588654440214-75bfd1c2-1b6a-4c2b-9c57-198bec9d4e64.png#height=706&id=IEhZC&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1412&originWidth=2794&originalType=binary&size=310772&status=done&style=none&width=1397",width:"1397"}),(0,r.kt)("p",null,"After the binding is completed, you can use the domain name to access."),(0,r.kt)("h3",{id:"2-some-restrictions-on-http-headers"},"2. Some restrictions on http headers"),(0,r.kt)("p",null,"Request Headers does not support customization starting with x-fc-and customization of the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"accept-encoding"),(0,r.kt)("li",{parentName:"ul"},"connection"),(0,r.kt)("li",{parentName:"ul"},"keep-alive"),(0,r.kt)("li",{parentName:"ul"},"proxy-authorization"),(0,r.kt)("li",{parentName:"ul"},"te"),(0,r.kt)("li",{parentName:"ul"},"trailer"),(0,r.kt)("li",{parentName:"ul"},"transfer-encoding")),(0,r.kt)("p",null,"Response Headers does not support customization starting with ",(0,r.kt)("inlineCode",{parentName:"p"},"x-fc-")," and customization of the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"connection"),(0,r.kt)("li",{parentName:"ul"},"content-length"),(0,r.kt)("li",{parentName:"ul"},"content-encoding"),(0,r.kt)("li",{parentName:"ul"},"date"),(0,r.kt)("li",{parentName:"ul"},"keep-alive"),(0,r.kt)("li",{parentName:"ul"},"proxy-authenticate"),(0,r.kt)("li",{parentName:"ul"},"server"),(0,r.kt)("li",{parentName:"ul"},"trailer"),(0,r.kt)("li",{parentName:"ul"},"transfer-encoding"),(0,r.kt)("li",{parentName:"ul"},"upgrade")),(0,r.kt)("p",null,"Request restrictions. If the following limit is exceeded, the 400 status code and InvalidArgument error code will be returned."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Headers Size: The total size of all Key and Value in the Headers must not exceed 4KB."),(0,r.kt)("li",{parentName:"ul"},"Path size: Including all Query Params, the total size of Path must not exceed 4KB."),(0,r.kt)("li",{parentName:"ul"},"Body size: The total size of HTTP Body must not exceed 6MB.")),(0,r.kt)("p",null,"Response restrictions. If the following limit is exceeded, the 502 status code and BadResponse error code will be returned."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Headers Size: The total size of all Key and Value in the Headers must not exceed 4KB.")),(0,r.kt)("h3",{id:"3-the-size-of-the-release-package"},"3. The size of the release package"),(0,r.kt)("p",null,"In order to improve the startup speed, the Alibaba Cloud FC container limits the size of the compressed package to 50M. Please simplify your back-end code dependencies as much as possible."),(0,r.kt)("p",null,"Generally speaking, the default scaffold (eggjs) of midway is built at about 9M, and other frameworks will be smaller. Please try to delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"package-lock.json")," before trying."),(0,r.kt)("h3",{id:"4-container-time-zone-problem"},"4. Container time zone problem"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Most Docker images are based on Alpine,Ubuntu,Debian,CentOS and other basic images.  Basically, UTC time is used, and the default time zone is zero time zone.")),(0,r.kt)("p",null,"The default time zone of Alibaba Cloud container environment is ",(0,r.kt)("inlineCode",{parentName:"p"},"GMT +0000"),". When you use the ",(0,r.kt)("inlineCode",{parentName:"p"},"new Date()")," and other frontend users to obtain the time zone, the time zone may not be processed by domestic users, and the difference will be 8 hours."),(0,r.kt)("p",null,"Domestic users may be accustomed to ",(0,r.kt)("inlineCode",{parentName:"p"},"GMT +0800")," by default. Can be adjusted by environment variables (configured on platform or f.yml)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"process.env.TZ = 'Asia/Shanghai';\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"provider:\n  name: aliyun\n  runtime: nodejs12\n    environment:\n    TZ: 'Asia/Shanghai'\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note that the scheduled task is triggered by the gateway and will not be affected by the function time zone configured here.")),(0,r.kt)("h3",{id:"5-revised-accesskey"},"5. Revised AccessKey"),(0,r.kt)("p",null,"Sometimes, we fill in a wrong ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessKey")," or other regional options on the first release. We provide a modifiable parameter to clean up the last error on the release."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"midway-bin deploy --resetConfig\n")),(0,r.kt)("p",null,"Enter default when prompted ",(0,r.kt)("inlineCode",{parentName:"p"},"Please create alias for key pair. If not, please enter to skip"),", otherwise the current AccessKey will not be used. If you only want to adjust specific fields, you can enter the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.s/access.yaml")," file, modify and save directly."),(0,r.kt)("h3",{id:"6-cli-releases-red-tips"},"6. CLI Releases Red Tips"),(0,r.kt)("p",null,"After the HTTP trigger is published, the following red prompt will appear. This is ",(0,r.kt)("strong",{parentName:"p"},"a prompt")," because if the domain name is not configured, Alibaba Cloud will add the ",(0,r.kt)("inlineCode",{parentName:"p"},"Content-Disposition: attachment")," the header to the response by default, and the browser opening address will change to attachment download. You can test the results by binding a custom domain name or a local curl."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1587036400388-b2ebe43f-fa7d-463b-b9b6-b38bf9e18430.png#height=268&id=H2BJz&margin=%5Bobject%20Object%5D&name=image.png&originHeight=268&originWidth=958&originalType=binary&ratio=1&size=242934&status=done&style=none&width=958",width:"958"}),(0,r.kt)("h3",{id:"7-specify-accesskey-at-the-time-of-release-etc"},"7. Specify accessKey at the time of release, etc."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export REGION=cn-beijing\nexport ACCOUNT_ID=xxx\nexport ACCESS_KEY_ID=xxx\nexport ACCESS_KEY_SECRET=xxx\n")),(0,r.kt)("p",null,"currently, alibaba cloud releases using funcraft tools. you can use the funcraft environment variables, load the startup command line, or use the yml variable filling method."),(0,r.kt)("h3",{id:"8-release-timeout"},"8. Release Timeout"),(0,r.kt)("p",null,"Sometimes the package is relatively large, and the upload of ",(0,r.kt)("inlineCode",{parentName:"p"},"midway-bin deploy")," may encounter the problem of timeout, which is controlled internally by the funcraft tool."),(0,r.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2020/png/501408/1598423950078-15838cbb-95f3-41f9-94ac-a31741b111d3.png#height=179&id=EOCLm&margin=%5Bobject%20Object%5D&name=image.png&originHeight=358&originWidth=2784&originalType=binary&ratio=1&size=310195&status=done&style=none&width=1392",width:"1392"}),(0,r.kt)("p",null,"Solution: Configure timeout in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.fcli/config.yaml")," in s (seconds)."),(0,r.kt)("p",null,"Generally speaking, the default scaffold (eggjs) of midway is built at about 9M, and other frameworks will be smaller. Please try to delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"package-lock.json")," before trying."),(0,r.kt)("p",null,"If there is no effect, if the package is too large, you can modify the deployment time of the fun tool in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.fcli/config.yaml"),", and add the timeout field to it."),(0,r.kt)("p",null,"Examples are as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"endpoint: ***************\napi_version: '2016-08-15'\naccess_key_id: ***************\naccess_key_secret: * * * * * * * * * * * * * * *\nsecurity_token: ''\ndebug: false\ntimeout: 50 ## deployment timeout, unit is s\nretries: 3\n\n")))}m.isMDXComponent=!0}}]);