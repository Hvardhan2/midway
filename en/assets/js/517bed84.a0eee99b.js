"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[72525],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(n),c=r,k=d["".concat(s,".").concat(c)]||d[c]||u[c]||o;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},28634:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={},i="How to update Midway",l={unversionedId:"how_to_update_midway",id:"how_to_update_midway",title:"How to update Midway",description:"When will Midway be updated",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/how_to_update_midway.md",sourceDirName:".",slug:"/how_to_update_midway",permalink:"/en/docs/how_to_update_midway",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/how_to_update_midway.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Quick Start",permalink:"/en/docs/quick_guide"},next:{title:"Upgrade to 3.x",permalink:"/en/docs/upgrade_v3"}},s={},p=[{value:"When will Midway be updated",id:"when-will-midway-be-updated",level:2},{value:"Update considerations",id:"update-considerations",level:2},{value:"Check package version exception",id:"check-package-version-exception",level:2},{value:"Update version using tools",id:"update-version-using-tools",level:2},{value:"Manually update the version",id:"manually-update-the-version",level:2},{value:"General item update",id:"general-item-update",level:3},{value:"Lerna project update",id:"lerna-project-update",level:3},{value:"Major version update",id:"major-version-update",level:2},{value:"View current package version",id:"view-current-package-version",level:2},{value:"Version matching query",id:"version-matching-query",level:2}],m={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-update-midway"},"How to update Midway"),(0,r.kt)("h2",{id:"when-will-midway-be-updated"},"When will Midway be updated"),(0,r.kt)("p",null,"In general, you may need to update in the following cases:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"After Midway has sent a new version, when you want to use the new functions"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"When you install a new component with lock file"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},"When there is an error that cannot be found in the method"))),(0,r.kt)("li",{parentName:"ul"},"... and so on")),(0,r.kt)("p",null,"For example, when the following error occurs"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Generally, it is a new package with components installed, but the old @midwayjs/core does not include this method, thus reporting an error.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/imgextra/i3/O1CN01dDNRZr1MBPewPo7Xg_!!6000000001396-2-tps-1196-317.png",alt:null})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"The general reason is that the version of @midwayjs/core that mock depends on does not have this method, indicating that the version is incorrect. It may be that the version is incorrectly referenced, or the version may be too low.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/imgextra/i3/O1CN01HVMJKP1xNuFO2Wv73_!!6000000006432-2-tps-1055-135.png",alt:null})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"When a new component is installed, we find that there is more than one version instance of a package")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/imgextra/i3/O1CN01jZxQu91YBCs0N9S9Y_!!6000000003020-2-tps-1133-43.png",alt:null})),(0,r.kt)("h2",{id:"update-considerations"},"Update considerations"),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Do not"),":"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Upgrade a @midwayjs/* package separately"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"Remove the symbol from the version number in package.json"))))),(0,r.kt)("h2",{id:"check-package-version-exception"},"Check package version exception"),(0,r.kt)("p",null,"You can use the following command to execute in the project root directory to check."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Community user\n$ npx midway-version\n# Internal user\n$ tnpx @ali/midway-version\n")),(0,r.kt)("p",null,"If the project is a dependency of pnpm installation, please use the following command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Community user\n$ pnpx midway-version\n# Internal user\n$ pnpx @ali/midway-version\n")),(0,r.kt)("h2",{id:"update-version-using-tools"},"Update version using tools"),(0,r.kt)("p",null,"You can use the following command to execute the update prompt in the project root directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Community user\n$ npx midway-version -u\n# Internal user\n$ tnpx @ali/midway-version -u\n")),(0,r.kt)("p",null,"If the project is a dependency of pnpm installation, please use the following command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Community user\n$ pnpx midway-version -u\n# Internal user\n$ pnpx @ali/midway-version -u\n")),(0,r.kt)("p",null,"If you want to write updates to ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),", please use the following command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Community user\n$ npx midway-version -u -w\n# Internal user\n$ tnpx @ali/midway-version -u -w\n")),(0,r.kt)("p",null,"If the project is a dependency of pnpm installation, please use the following command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Community user\n$ pnpx midway-version -u -w\n# Internal user\n$ pnpx @ali/midway-version -u -w\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Newer versions will be written to ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"package-lock.json")," and require reinstallation of dependencies.")),(0,r.kt)("h2",{id:"manually-update-the-version"},"Manually update the version"),(0,r.kt)("h3",{id:"general-item-update"},"General item update"),(0,r.kt)("p",null,"For projects that normally use npm/yarn, please follow the following procedure for upgrading"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"delete package-lock.json or yarn.lock"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"completely delete node_modules (such as rm -rf node_modules)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},"Reinstall dependency (npm install or yarn)")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"We do not guarantee the effect of using other tools and cli separate upgrade packages.")),(0,r.kt)("h3",{id:"lerna-project-update"},"Lerna project update"),(0,r.kt)("p",null,"If you use lerna to develop a project, due to the existence of hoist mode, please follow the following procedure (take lerna3 as an example)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Clean up the node_modules of subpackages, such as (lerna clean -- yes)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"Delete the node_modules of the main package (such as rm -rf node_modules)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},"delete package-lock.json or yarn.lock"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:4},(0,r.kt)("li",{parentName:"ol"},"Reinstall Dependency (npm install & & lerna bootstrap)")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"We do not guarantee the effect of using other tools and cli separate upgrade packages.")),(0,r.kt)("h2",{id:"major-version-update"},"Major version update"),(0,r.kt)("p",null,"You must manually change the version number, for example, from ",(0,r.kt)("inlineCode",{parentName:"p"},"^ 1.0.0")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"^ 2.0.0"),"."),(0,r.kt)("h2",{id:"view-current-package-version"},"View current package version"),(0,r.kt)("p",null,"The Midway package is managed and released using the standard Semver version. The version specified in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," usually starts with ",(0,r.kt)("inlineCode",{parentName:"p"},"^"),", indicating that it is compatible in a wide range of versions."),(0,r.kt)("p",null,"For example, if ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/core")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"^ 2.3.0")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),", the latest version of ",(0,r.kt)("inlineCode",{parentName:"p"},"2.x")," is installed according to npm installation rules."),(0,r.kt)("p",null,"Therefore, it is normal that the actual installed version is higher than the version specified in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"npm ls package name")," to view the specific version, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"npm ls @midwayjs/core")," to view the version of ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/core"),"."),(0,r.kt)("h2",{id:"version-matching-query"},"Version matching query"),(0,r.kt)("p",null,"Because lerna packages have certain dependencies, for example, the modified package will only be updated. ",(0,r.kt)("strong",{parentName:"p"},"The version of the package under the midway may not be the same.")),(0,r.kt)("p",null,"For example, it is normal that the version of ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/Web")," is higher than that of ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/core"),"."),(0,r.kt)("p",null,"Midway submits a ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@midwayjs/version"},"@midwayjs/version")," package at each conference, which contains each of our versions and all the package versions matched by that version. Please ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/midwayjs/midway/tree/2.x/packages/version/versions"},"visit here")," to view it."),(0,r.kt)("p",null,"The file names in the directory are created according to the ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/decorator version-@midwayjs/core version. json")," rule. Each version corresponds to a JSON file."),(0,r.kt)("p",null,"The file content uses the package name as the key and the compatible matching version name as the value."),(0,r.kt)("p",null,"For example, the egg-layer package versions compatible with the current file decorator(v2.10.18) and core(v2.10.18) are v2.10.18 and v2.10.19."),(0,r.kt)("p",null,"If the file name of the combination of decorator and core is not found, or the versions in the file do not match, there may be a ",(0,r.kt)("strong",{parentName:"p"},"version problem"),"."),(0,r.kt)("p",null,"Examples of content are as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "@midwayjs/egg-layer": [\n    "2.10.18",\n    "2.10.19"\n  ],\n  "@midwayjs/express-layer": "2.10.18",\n  "@midwayjs/faas-typings": "2.10.7",\n  "@midwayjs/koa-layer": "2.10.18",\n  "@midwayjs/runtime-engine": "2.10.14",\n  "@midwayjs/runtime-mock": "2.10.14",\n  "@midwayjs/serverless-app": "2.10.18",\n  "@midwayjs/serverless-aws-starter": "2.10.14",\n  "@midwayjs/serverless-fc-starter": "2.10.18",\n  "@midwayjs/serverless-fc-trigger": "2.10.18",\n  "@midwayjs/serverless-http-parser": "2.10.7",\n  "@midwayjs/serverless-scf-starter": "2.10.14",\n  "@midwayjs/serverless-scf-trigger": "2.10.18",\n  "@midwayjs/static-layer": "2.10.18",\n  "@midwayjs/bootstrap": "2.10.18",\n  "@midwayjs/cache": "2.10.18",\n  "@midwayjs/consul": "2.10.18",\n  "@midwayjs/core": "2.10.18",\n  "@midwayjs/decorator": "2.10.18",\n  "@midwayjs/faas": "2.10.18",\n  "@midwayjs/grpc": "2.10.18",\n  "@midwayjs/logger": "2.10.18",\n  "midway-schedule": "2.10.18",\n  "midway": [\n    "2.10.18",\n    "2.10.19"\n  ],\n  "@midwayjs/mock": "2.10.18",\n  "@midwayjs/prometheus": "2.10.18",\n  "@midwayjs/rabbitmq": "2.10.18",\n  "@midwayjs/socketio": "2.10.18",\n  "@midwayjs/task": [\n    "2.10.18",\n    "2.10.19"\n  ],\n  "@midwayjs/typegoose": "2.10.18",\n  "@midwayjs/version": [\n    "2.10.18",\n    "2.10.19"\n  ],\n  "@midwayjs/express": "2.10.18",\n  "@midwayjs/koa": "2.10.18",\n  "@midwayjs/web": [\n    "2.10.18",\n    "2.10.19"\n  ]\n}\n')))}u.isMDXComponent=!0}}]);