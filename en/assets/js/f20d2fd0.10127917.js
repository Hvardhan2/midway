"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[73083],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(n),d=r,f=u["".concat(s,".").concat(d)]||u[d]||m[d]||o;return n?a.createElement(f,p(p({ref:t},c),{},{components:n})):a.createElement(f,p({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,p=new Array(o);p[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,p[1]=i;for(var l=2;l<o;l++)p[l]=n[l];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},21252:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>p,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const o={},p="pm2",i={unversionedId:"extensions/pm2",id:"extensions/pm2",title:"pm2",description:"PM2 is the production process manager for Node.js applications with built-in load balancers. It can be used to simplify many tedious tasks of Node application management, such as performance monitoring, automatic restart, load balancing, etc.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/extensions/pm2.md",sourceDirName:"extensions",slug:"/extensions/pm2",permalink:"/en/docs/extensions/pm2",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/extensions/pm2.md",tags:[],version:"current",frontMatter:{},sidebar:"component",previous:{title:"Code dyeing",permalink:"/en/docs/extensions/code_dye"},next:{title:"cfork",permalink:"/en/docs/extensions/cfork"}},s={},l=[{value:"Installation",id:"installation",level:2},{value:"Common commands",id:"common-commands",level:2},{value:"Start application",id:"start-application",level:2},{value:"Docker container startup",id:"docker-container-startup",level:2}],c={toc:l};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"pm2"},"pm2"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/Unitech/pm2"},"PM2")," is the production process manager for Node.js applications with built-in load balancers. It can be used to simplify many tedious tasks of Node application management, such as performance monitoring, automatic restart, load balancing, etc."),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,"We usually install pm2 to the global."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm install pm2 -g# command line installation pm2\n")),(0,r.kt)("h2",{id:"common-commands"},"Common commands"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ pm2 start# Start a service\n$ pm2 list# lists the current services\n$ pm2 stop# stop a service\n$ pm2 restart# Restart a service\n$ pm2 delete# delete a service\n$ pm2 logs# view the output log of the service\n")),(0,r.kt)("p",null,"For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"pm2 list")," is displayed in a table."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2021/png/501408/1616560437389-b193a0d0-b463-49f1-a347-8dec20e7504d.png",alt:null})),(0,r.kt)("p",null,"All services of pm2 have an array id, and you can quickly operate it with id."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ pm2 stop 1 # stop service number 1\n$ pm2 delete 1 # delete service number 1\n")),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"-- name")," parameter to add an application name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ pm2 start ./bootstrap.js --name test_app\n")),(0,r.kt)("p",null,"Then you can use this application name to operate start and stop."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ pm2 stop test_app\n$ pm2 restart test_app\n")),(0,r.kt)("h2",{id:"start-application"},"Start application"),(0,r.kt)("p",null,"Midway applications generally use ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run start")," for online deployment. The corresponding command is ",(0,r.kt)("inlineCode",{parentName:"p"},"NODE_ENV = production node bootstrap.js"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Compile npm run build is required before deployment")),(0,r.kt)("p",null,"The corresponding pm2 command is"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ NODE_ENV=production pm2 start ./bootstrap.js --name midway_app -i 4\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"-- name is used to specify the application name"),(0,r.kt)("li",{parentName:"ul"},"-I is used to specify the number of instances (processes) to be started and will be started in cluster mode")),(0,r.kt)("p",null,"The effect is as follows:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2021/png/501408/1616562075255-088155ee-7c4f-4eae-b5c5-db826f78b519.png",alt:null})),(0,r.kt)("h2",{id:"docker-container-startup"},"Docker container startup"),(0,r.kt)("p",null,"In the Docker container, the code started in the background will be exited, which will not achieve the expected effect. Pm2 uses another command to support container startup."),(0,r.kt)("p",null,"Please change the command to pm2-runtime start."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ NODE_ENV=production pm2-runtime start ./bootstrap.js --name midway_app -i 4\n")),(0,r.kt)("p",null,"For more information about the pm2 behavior, see ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/pm2#container-support"},"Pm2 container deployment"),"."))}m.isMDXComponent=!0}}]);