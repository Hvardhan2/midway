"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2125],{3905:(e,r,t)=>{t.d(r,{Zo:()=>u,kt:()=>h});var n=t(67294);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),c=function(e){var r=n.useContext(l),t=r;return e&&(t="function"==typeof e?e(r):s(s({},r),e)),t},u=function(e){var r=c(e.components);return n.createElement(l.Provider,{value:r},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(t),d=o,h=p["".concat(l,".").concat(d)]||p[d]||m[d]||a;return t?n.createElement(h,s(s({ref:r},u),{},{components:t})):n.createElement(h,s({ref:r},u))}));function h(e,r){var t=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var a=t.length,s=new Array(a);s[0]=d;var i={};for(var l in r)hasOwnProperty.call(r,l)&&(i[l]=r[l]);i.originalType=e,i[p]="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=t[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5602:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var n=t(87462),o=(t(67294),t(3905));const a={},s="Custom error",i={unversionedId:"custom_error",id:"custom_error",title:"Custom error",description:"In Node.js, each exception is an instance of the built-in Error type.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/custom_error.md",sourceDirName:".",slug:"/custom_error",permalink:"/en/docs/custom_error",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/custom_error.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Custom decorator",permalink:"/en/docs/custom_decorator"},next:{title:"Change Source Dir",permalink:"/en/docs/change_start_dir"}},l={},c=[{value:"Custom error code",id:"custom-error-code",level:2}],u={toc:c},p="wrapper";function m(e){let{components:r,...t}=e;return(0,o.kt)(p,(0,n.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"custom-error"},"Custom error"),(0,o.kt)("p",null,"In Node.js, each exception is an instance of the built-in Error type."),(0,o.kt)("p",null,"By extending the standard Error,Midway provides built-in error types with additional attributes."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"export class MidwayError extends Error {\n    // ...\n}\n")),(0,o.kt)("p",null,"At this stage, all errors provided by Midway framework are instances thrown by this error class."),(0,o.kt)("p",null,"MidwayError includes several properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The name of the name error, such as Error,TypeError, etc., is the class name of the custom error in the custom error."),(0,o.kt)("li",{parentName:"ul"},"message error message"),(0,o.kt)("li",{parentName:"ul"},"Stack error stack"),(0,o.kt)("li",{parentName:"ul"},"Code custom error code"),(0,o.kt)("li",{parentName:"ul"},"Cause the source of the error")),(0,o.kt)("p",null,"We can use it by simply instantiating and throwing it out, such:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayError } from '@midwayjs/core';\n\n// ...\n\nasync findAll() {\n  throw new MidwayError('my custom error');\n}\n")),(0,o.kt)("p",null,"Some errors can also be customized in the business."),(0,o.kt)("p",null,"In common, we will uniformly define exceptions into the error directory."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u279c  my_midway_app tree\n.\n\u251c\u2500\u2500 src\n\u2502   \u2514\u2500\u2500 error\n\u2502       \u251c\u2500\u2500 customA.error.ts\n\u2502       \u2514\u2500\u2500 customB.error.ts\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 tsconfig.json\n")),(0,o.kt)("p",null,"If the business has some reuse exceptions, such as fixed errors"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/error/custom.error.ts\nimport { HttpStatus } from '@midwayjs/core';\n\nexport class CustomError extends MidwayError {\n  constructor() {\n    super('my custom error', 'CUSTOM_ERROR_CODE_10000');\n  }\n}\n")),(0,o.kt)("p",null,"Then throw the use in the business."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { CustomError } from './error/custom.error';\n\n// ...\n\nasync findAll() {\n  throw new CustomError();\n}\n\n")),(0,o.kt)("p",null,"The above ",(0,o.kt)("inlineCode",{parentName:"p"},"CUSTOM_ ERROR_CODE_10000")," is the wrong error code. Generally, we will assign different error codes and error messages to different errors to facilitate troubleshooting."),(0,o.kt)("h2",{id:"custom-error-code"},"Custom error code"),(0,o.kt)("p",null,"The framework provides a universal mechanism for registering error codes. Error codes can be easily debuggered and counted later."),(0,o.kt)("p",null,"It is very useful when business errors are defined and component errors are defined."),(0,o.kt)("p",null,"The error code is generally an enumeration value, such:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"const CustomErrorEnum = {\n  UNKNOWN: 10000\n  COMMON: 10001\n  PARAM_TYPE: 10002,\n  // ...\n};\n")),(0,o.kt)("p",null,"In encoding, we will provide a fixed error code and hope that there will be no conflicts in the SDK or components, which requires framework support."),(0,o.kt)("p",null,"Midway provides ",(0,o.kt)("inlineCode",{parentName:"p"},"registerErrorCode")," method for registering non-duplicate error codes with the framework and for certain formatting."),(0,o.kt)("p",null,"For example, within the framework, we have the following definition:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { registerErrorCode } from '@midwayjs/core';\n\nexport const FrameworkErrorEnum = registerErrorCode('midway', {\n  UNKNOWN: 10000\n  COMMON: 10001\n  PARAM_TYPE: 10002,\n    // ...\n} as const);\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"registerErrorCode")," contains two parameters:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Error grouping, such as ",(0,o.kt)("inlineCode",{parentName:"li"},"midway"),", is the name of the built-in error group in the framework. In an application, this group name should not be repeated."),(0,o.kt)("li",{parentName:"ul"},"The error enumeration object is named key and the error code is value.")),(0,o.kt)("p",null,"The method returns an error enumeration value with the error name as the key and the error group plus the error code as the value."),(0,o.kt)("p",null,"For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"FrameworkErrorEnum.UNKNOWN\n// => output: MIDWAY_10000\n\nFrameworkErrorEnum.COMMON\n// => output: MIDWAY_10001\n")),(0,o.kt)("p",null,"In this way, when the ",(0,o.kt)("inlineCode",{parentName:"p"},"MIDWAY_10000")," error code appears in the error, we will know what the error is, and all the errors can be precipitated by cooperating with the document."),(0,o.kt)("p",null,"When defining errors, use this error code enumeration directly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"export class MidwayParameterError extends MidwayError {\n  constructor(message?: string) {\n    super(message ?? 'Parameter type not match', FrameworkErrorEnum.PARAM_TYPE);\n  }\n}\n\n// user code\nasync findAll(data) {\n  if (! data.user) {\n    throw new MidwayParameterError();\n  }\n  // ...\n}\n\n// output\n// 2022-01-02 14:02:29,124 ERROR 14259 MidwayParameterError: Parameter type not match\n// at APIController.findAll (....\n// at /Users/harry/project/midway-v3/packages/core/src/common/webGenerator.ts:38:57\n// at processTicksAndRejections (node:internal/process/task_queues:96:5) {\n// code: 'MIDWAY_10002',\n// cause: undefined\n//}\n\n")))}m.isMDXComponent=!0}}]);