"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[92501],{3905:(e,r,n)=>{n.d(r,{Zo:()=>c,kt:()=>u});var t=n(67294);function s(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){s(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function l(e,r){if(null==e)return{};var n,t,s=function(e,r){if(null==e)return{};var n,t,s={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||(s[n]=e[n]);return s}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=t.createContext({}),p=function(e){var r=t.useContext(o),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},c=function(e){var r=p(e.components);return t.createElement(o.Provider,{value:r},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},v=t.forwardRef((function(e,r){var n=e.components,s=e.mdxType,a=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),v=s,u=m["".concat(o,".").concat(v)]||m[v]||d[v]||a;return n?t.createElement(u,i(i({ref:r},c),{},{components:n})):t.createElement(u,i({ref:r},c))}));function u(e,r){var n=arguments,s=r&&r.mdxType;if("string"==typeof e||s){var a=n.length,i=new Array(a);i[0]=v;var l={};for(var o in r)hasOwnProperty.call(r,o)&&(l[o]=r[o]);l.originalType=e,l[m]="string"==typeof e?e:s,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}v.displayName="MDXCreateElement"},55649:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var t=n(87462),s=(n(67294),n(3905));const a={},i="\u4ece Serverless v2 \u8fc1\u79fb\u5230 v3",l={unversionedId:"serverless/serverless_v2_upgrade_serverless_v3",id:"serverless/serverless_v2_upgrade_serverless_v3",title:"\u4ece Serverless v2 \u8fc1\u79fb\u5230 v3",description:"\u57fa\u4e8e Midway \u5347\u7ea7\u5230 v3 \u7684\u7f18\u6545\uff0cServerless \u4f53\u7cfb\u4e5f\u540c\u6b65\u5347\u7ea7\u5230\u4e86 v3 \u7248\u672c\u3002",source:"@site/docs/serverless/serverless_v2_upgrade_serverless_v3.md",sourceDirName:"serverless",slug:"/serverless/serverless_v2_upgrade_serverless_v3",permalink:"/docs/serverless/serverless_v2_upgrade_serverless_v3",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/serverless/serverless_v2_upgrade_serverless_v3.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"\u4ecb\u7ecd",permalink:"/docs/serverless/serverless_intro"},next:{title:"\u5f00\u53d1\u51fd\u6570",permalink:"/docs/serverless/serverless_dev"}},o={},p=[{value:"1\u3001\u9879\u76ee\u5305\u7248\u672c\u7684\u5347\u7ea7",id:"1\u9879\u76ee\u5305\u7248\u672c\u7684\u5347\u7ea7",level:2},{value:"2\u3001\u5165\u53e3\u4e3b\u6846\u67b6\u7684\u53d8\u5316",id:"2\u5165\u53e3\u4e3b\u6846\u67b6\u7684\u53d8\u5316",level:2},{value:"3\u3001\u6d4b\u8bd5\u4ee3\u7801\u53d8\u5316",id:"3\u6d4b\u8bd5\u4ee3\u7801\u53d8\u5316",level:2},{value:"5\u3001\u90e8\u7f72\u65b9\u5f0f\u7684\u53d8\u5316",id:"5\u90e8\u7f72\u65b9\u5f0f\u7684\u53d8\u5316",level:2}],c={toc:p},m="wrapper";function d(e){let{components:r,...n}=e;return(0,s.kt)(m,(0,t.Z)({},c,n,{components:r,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"\u4ece-serverless-v2-\u8fc1\u79fb\u5230-v3"},"\u4ece Serverless v2 \u8fc1\u79fb\u5230 v3"),(0,s.kt)("p",null,"\u57fa\u4e8e Midway \u5347\u7ea7\u5230 v3 \u7684\u7f18\u6545\uff0cServerless \u4f53\u7cfb\u4e5f\u540c\u6b65\u5347\u7ea7\u5230\u4e86 v3 \u7248\u672c\u3002"),(0,s.kt)("p",null,"\u672c\u6587\u7ae0\u4ecb\u7ecd\u5982\u4f55\u4ece Serverless v2.0 \u8fc1\u79fb\u5230 Serverless v3.0\uff0c\u548c\u4f20\u7edf\u5e94\u7528\u5347\u7ea7\u975e\u5e38\u7684\u7c7b\u4f3c\u3002"),(0,s.kt)("admonition",{type:"caution"},(0,s.kt)("p",{parentName:"admonition"},"\u65b0\u7684 Serverless \u5f53\u524d\u53ea\u652f\u6301\u963f\u91cc\u4e91\u51fd\u6570\u3002")),(0,s.kt)("h2",{id:"1\u9879\u76ee\u5305\u7248\u672c\u7684\u5347\u7ea7"},"1\u3001\u9879\u76ee\u5305\u7248\u672c\u7684\u5347\u7ea7"),(0,s.kt)("p",null,"\u4e00\u4e9b\u4f9d\u8d56\u5305\u5347\u7ea7\uff0c\u5305\u62ec\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"midway \u53ca\u7ec4\u4ef6\u7248\u672c\u5347\u7ea7\u5230 3.x"),(0,s.kt)("li",{parentName:"ul"},"CLI\uff0cJest \u7b49\u7248\u672c\u5347\u7ea7"),(0,s.kt)("li",{parentName:"ul"},"\u79fb\u9664\u4e86\u4e00\u4e9b\u4e0d\u518d\u4f7f\u7528\u7684\u4f9d\u8d56\uff0c\u6bd4\u5982 ",(0,s.kt)("inlineCode",{parentName:"li"},"@midwayjs/serverless-app"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-diff"},'"scripts": {\n  "dev": "cross-env NODE_ENV=local midway-bin dev --ts",\n  "test": "cross-env midway-bin test --ts",\n-  "deploy": "cross-env UDEV_NODE_ENV=production midway-bin deploy",\n  "lint": "mwts check",\n  "lint:fix": "mwts fix"\n},\n"dependencies": {\n-   "@midwayjs/core": "^2.3.0",\n-   "@midwayjs/decorator": "^2.3.0",\n-   "@midwayjs/faas": "^2.0.0"\n+   "@midwayjs/core": "^3.12.0",\n+   "@midwayjs/faas": "^3.12.0",\n+   "@midwayjs/fc-starter": "^3.12.0",\n+   "@midwayjs/logger": "^2.0.0"\n},\n"devDependencies": {\n-  "@midwayjs/cli": "^1.2.45",\n-  "@midwayjs/cli-plugin-faas": "^1.2.45",\n-  "@midwayjs/fcli-plugin-fc": "^1.2.45",\n-  "@midwayjs/mock": "^2.8.7",\n-  "@midwayjs/serverless-app": "^2.8.7",\n-  "@midwayjs/serverless-fc-trigger": "^2.10.3",\n-  "@midwayjs/serverless-fc-starter": "^2.10.3",\n-  "@types/jest": "^26.0.10",\n-  "@types/node": "14",\n-  "cross-env": "^6.0.0",\n-  "jest": "^26.4.0",\n-  "mwts": "^1.0.5",\n-  "ts-jest": "^26.2.0",\n-  "typescript": "~4.6.0"\n+  "@midwayjs/mock": "^3.12.0",\n+  "@types/jest": "29",\n+  "@types/node": "16",\n+  "cross-env": "^7.0.3",\n+  "jest": "29",\n+  "mwts": "^1.3.0",\n+  "ts-jest": "29",\n+  "ts-node": "^10.9.1",\n+  "typescript": "~5.1.0"\n}\n')),(0,s.kt)("h2",{id:"2\u5165\u53e3\u4e3b\u6846\u67b6\u7684\u53d8\u5316"},"2\u3001\u5165\u53e3\u4e3b\u6846\u67b6\u7684\u53d8\u5316"),(0,s.kt)("p",null,"\u663e\u5f0f\u58f0\u660e faas \u4f5c\u4e3a\u4e3b\u6846\u67b6\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/configuration\nimport * as faas from '@midwayjs/faas';\n\n@Configuration({\n  // ...\n  imports: [\n    faas\n  ],\n})\nexport class MainConfiguration {\n  // ...\n}\n\n")),(0,s.kt)("h2",{id:"3\u6d4b\u8bd5\u4ee3\u7801\u53d8\u5316"},"3\u3001\u6d4b\u8bd5\u4ee3\u7801\u53d8\u5316"),(0,s.kt)("p",null,"\u79fb\u9664\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/serverless-app")," \u7684\u4f9d\u8d56\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-diff"},"import { createFunctionApp, close, createHttpRequest } from '@midwayjs/mock';\n- import { Framework, Application } from '@midwayjs/serverless-app';\n+ import { Framework, Application } from '@midwayjs/faas';\n")),(0,s.kt)("p",null,"\u79fb\u9664\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/serverless-fc-trigger")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/serverless-fc-starter")," \u4f9d\u8d56\uff0c\u4fee\u6539\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/fc-starter"),"\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Application, Context, Framework } from '@midwayjs/faas';\nimport { mockContext } from '@midwayjs/fc-starter';\nimport { createFunctionApp } from '@midwayjs/mock';\n\ndescribe('test/hello_aliyun.test.ts', () => {\n\n  it('should get result from event trigger', async () => {\n    \n    // create app\n    const app: Application = await createFunctionApp<Framework>(join(__dirname, '../'), {\n      initContext: Object.assign(mockContext(), {\n        function: {\n          name: '***',\n          handler: '***'\n        }\n      }),\n    });\n    \n    // ...\n    \n    await close(app);\n  });\n});\n")),(0,s.kt)("p",null,"\u4e00\u4e9b API \u7684\u66ff\u4ee3\uff0c\u6bd4\u5982\u539f\u6709\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"createXXXEvent"),"\uff0c\u5c06\u53d8\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"mockXXXEvent"),"\uff0c\u539f\u6709\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"createInitializeContext")," \u5c06\u53d8\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"mockContext")," \u65b9\u6cd5\u3002"),(0,s.kt)("p",null,"\u8fd9\u4e9b API \u5c06\u76f4\u63a5\u4ece ",(0,s.kt)("inlineCode",{parentName:"p"},"@midwayjs/fc-starter")," \u4e2d\u5bfc\u51fa\u3002"),(0,s.kt)("h2",{id:"5\u90e8\u7f72\u65b9\u5f0f\u7684\u53d8\u5316"},"5\u3001\u90e8\u7f72\u65b9\u5f0f\u7684\u53d8\u5316"),(0,s.kt)("p",null,"\u4e0d\u518d\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"midway-bin deploy")," \u8fdb\u884c\u90e8\u7f72\uff0c\u5c06\u91c7\u7528\u5e73\u53f0\u81ea\u5df1\u7684 CLI \u5de5\u5177\uff0cMidway \u53ea\u63d0\u4f9b\u6846\u67b6\u548c\u672c\u5730\u5f00\u53d1\u80fd\u529b\u3002"),(0,s.kt)("p",null,"\u66f4\u591a\u7684\u90e8\u7f72\u8c03\u6574\uff0c\u8bf7\u67e5\u8be2 ",(0,s.kt)("a",{parentName:"p",href:"/docs/serverless/aliyun_faas"},"\u7eaf\u51fd\u6570\u90e8\u7f72"),"\u3002"))}d.isMDXComponent=!0}}]);