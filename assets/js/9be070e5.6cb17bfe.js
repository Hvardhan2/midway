"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[65834],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>u});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),g=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},s=function(e){var t=g(e.components);return a.createElement(o.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),d=g(n),c=l,u=d["".concat(o,".").concat(c)]||d[c]||m[c]||r;return n?a.createElement(u,p(p({ref:t},s),{},{components:n})):a.createElement(u,p({ref:t},s))}));function u(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,p=new Array(r);p[0]=c;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[d]="string"==typeof e?e:l,p[1]=i;for(var g=2;g<r;g++)p[g]=n[g];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},97337:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>p,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>g});var a=n(87462),l=(n(67294),n(3905));const r={title:"EggJS"},p=void 0,i={unversionedId:"eggjs",id:"version-2.0.0/eggjs",title:"EggJS",description:"Midway \u53ef\u4ee5\u4f7f\u7528 EggJS \u4f5c\u4e3a\u4e0a\u5c42 Web \u6846\u67b6\uff0cEggJS \u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u5e38\u7528\u7684\u63d2\u4ef6\u548c API\uff0c\u5e2e\u52a9\u7528\u6237\u5feb\u901f\u6784\u5efa\u4f01\u4e1a\u7ea7 Web \u5e94\u7528\u3002\u672c\u7ae0\u8282\u5185\u5bb9\uff0c\u4e3b\u8981\u4ecb\u7ecd EggJS \u5728 Midway \u4e2d\u5982\u4f55\u4f7f\u7528\u81ea\u8eab\u7684\u80fd\u529b\u3002",source:"@site/versioned_docs/version-2.0.0/eggjs.md",sourceDirName:".",slug:"/eggjs",permalink:"/docs/2.0.0/eggjs",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/versioned_docs/version-2.0.0/eggjs.md",tags:[],version:"2.0.0",frontMatter:{title:"EggJS"},sidebar:"common",previous:{title:"\u53c2\u6570\u6821\u9a8c\u548c\u8f6c\u6362",permalink:"/docs/2.0.0/validate"},next:{title:"Koa",permalink:"/docs/2.0.0/koa"}},o={},g=[{value:"\u4f9d\u8d56\u5305",id:"\u4f9d\u8d56\u5305",level:2},{value:"\u548c\u9ed8\u8ba4 EggJS \u7684\u4e0d\u540c\u4e4b\u5904",id:"\u548c\u9ed8\u8ba4-eggjs-\u7684\u4e0d\u540c\u4e4b\u5904",level:2},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784",level:2},{value:"\u914d\u7f6e\u5b9a\u4e49",id:"\u914d\u7f6e\u5b9a\u4e49",level:2},{value:"\u63d2\u4ef6",id:"\u63d2\u4ef6",level:2},{value:"\u5f00\u542f\u63d2\u4ef6",id:"\u5f00\u542f\u63d2\u4ef6",level:3},{value:"\u4f7f\u7528\u63d2\u4ef6",id:"\u4f7f\u7528\u63d2\u4ef6",level:3},{value:"Web \u4e2d\u95f4\u4ef6",id:"web-\u4e2d\u95f4\u4ef6",level:2},{value:"\u914d\u7f6e\u5168\u5c40\u4e2d\u95f4\u4ef6",id:"\u914d\u7f6e\u5168\u5c40\u4e2d\u95f4\u4ef6",level:3},{value:"\u914d\u7f6e\u8def\u7531\u4e2d\u95f4\u4ef6",id:"\u914d\u7f6e\u8def\u7531\u4e2d\u95f4\u4ef6",level:3},{value:"\u5173\u4e8e Match \u548c Ignore",id:"\u5173\u4e8e-match-\u548c-ignore",level:3},{value:"\u6a21\u677f\u6e32\u67d3",id:"\u6a21\u677f\u6e32\u67d3",level:2},{value:"\u6587\u4ef6\u4e0a\u4f20",id:"\u6587\u4ef6\u4e0a\u4f20",level:2},{value:"File \u6a21\u5f0f",id:"file-\u6a21\u5f0f",level:3},{value:"\u9759\u6001\u6587\u4ef6",id:"\u9759\u6001\u6587\u4ef6",level:2},{value:"\u5b9a\u65f6\u4efb\u52a1",id:"\u5b9a\u65f6\u4efb\u52a1",level:2},{value:"\u7f16\u5199\u4ee3\u7801",id:"\u7f16\u5199\u4ee3\u7801",level:3},{value:"\u624b\u52a8\u8c03\u7528",id:"\u624b\u52a8\u8c03\u7528",level:3},{value:"\u65e5\u5fd7",id:"\u65e5\u5fd7",level:2},{value:"\u81ea\u5b9a\u4e49\u65e5\u5fd7",id:"\u81ea\u5b9a\u4e49\u65e5\u5fd7",level:3},{value:"\u65e5\u5fd7\u7b49\u7ea7",id:"\u65e5\u5fd7\u7b49\u7ea7",level:3},{value:"\u9ed8\u8ba4\u65e5\u5fd7\u540d",id:"\u9ed8\u8ba4\u65e5\u5fd7\u540d",level:3},{value:"\u670d\u52a1\u5668\u65e5\u5fd7",id:"\u670d\u52a1\u5668\u65e5\u5fd7",level:3},{value:"\u5f02\u5e38\u5904\u7406",id:"\u5f02\u5e38\u5904\u7406",level:2},{value:"errorPageUrl",id:"errorpageurl",level:3},{value:"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406",id:"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406",level:3},{value:"404",id:"404",level:3},{value:"\u81ea\u5b9a\u4e49 404 \u54cd\u5e94",id:"\u81ea\u5b9a\u4e49-404-\u54cd\u5e94",level:3},{value:"\u4e0d\u5b58\u5728\u5b9a\u4e49\u7684\u95ee\u9898",id:"\u4e0d\u5b58\u5728\u5b9a\u4e49\u7684\u95ee\u9898",level:2},{value:"\u6269\u5c55 Application/Context/Request/Response",id:"\u6269\u5c55-applicationcontextrequestresponse",level:2},{value:"\u589e\u52a0\u6269\u5c55\u6587\u4ef6",id:"\u589e\u52a0\u6269\u5c55\u6587\u4ef6",level:3},{value:"\u589e\u52a0\u6269\u5c55\u5b9a\u4e49",id:"\u589e\u52a0\u6269\u5c55\u5b9a\u4e49",level:3},{value:"\u6846\u67b6\u542f\u52a8\u53c2\u6570",id:"\u6846\u67b6\u542f\u52a8\u53c2\u6570",level:2},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"\u9ed8\u8ba4\u7684 csrf \u9519\u8bef",id:"\u9ed8\u8ba4\u7684-csrf-\u9519\u8bef",level:3},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2},{value:"\u751f\u6210 ts \u5b9a\u4e49",id:"\u751f\u6210-ts-\u5b9a\u4e49",level:3},{value:"EggJS \u4e2d Configuration \u7684\u7279\u6b8a\u60c5\u51b5",id:"eggjs-\u4e2d-configuration-\u7684\u7279\u6b8a\u60c5\u51b5",level:3}],s={toc:g};function d(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Midway \u53ef\u4ee5\u4f7f\u7528 EggJS \u4f5c\u4e3a\u4e0a\u5c42 Web \u6846\u67b6\uff0cEggJS \u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u5e38\u7528\u7684\u63d2\u4ef6\u548c API\uff0c\u5e2e\u52a9\u7528\u6237\u5feb\u901f\u6784\u5efa\u4f01\u4e1a\u7ea7 Web \u5e94\u7528\u3002\u672c\u7ae0\u8282\u5185\u5bb9\uff0c\u4e3b\u8981\u4ecb\u7ecd EggJS \u5728 Midway \u4e2d\u5982\u4f55\u4f7f\u7528\u81ea\u8eab\u7684\u80fd\u529b\u3002"),(0,l.kt)("h2",{id:"\u4f9d\u8d56\u5305"},"\u4f9d\u8d56\u5305"),(0,l.kt)("p",null,"\u9488\u5bf9 EggJS\uff0cMidway \u63d0\u4f9b\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"@midwayjs/web"),"\xa0 \u5305\u8fdb\u884c\u4e86\u9002\u914d\uff0c\u5728\u5176\u4e2d\u63d0\u4f9b\u4e86 Midway \u7279\u6709\u7684\u4f9d\u8d56\u6ce8\u5165\u3001\u5207\u9762\u7b49\u80fd\u529b\u3002"),(0,l.kt)("p",null,"\u9488\u5bf9 EggJS \u573a\u666f\uff0c\u8fd9\u4e9b\u5305\u5217\u4e3e\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'  "dependencies": {\n    "@midwayjs/web": "^2.3.11",\n    "@midwayjs/decorator": "^2.3.11",\n    "egg": "^2.0.0",\n    "egg-scripts": "^2.10.0",\n    "midway": "^2.3.11"\n  },\n  "devDependencies": {\n    "@midwayjs/egg-ts-helper": "^1.0.1",\n  },\n')),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"@midwayjs/web"),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u5fc5\u987b"),"\uff0cMidway EggJS \u9002\u914d\u5c42"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"@midwayjs/decorator"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"\u5fc5\u987b"),"\uff0cMidway \u7cfb\u5217\u901a\u7528\u7684\u88c5\u9970\u5668\u5305")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"midway"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"\u53ef\u9009"),"\uff0cMidway \u542f\u52a8\u9002\u914d\u5305\uff0c\u63d0\u4f9b\u4e86 midway v1 \u517c\u5bb9")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"egg"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"\u5fc5\u987b"),"\uff0cEggJS \u4f9d\u8d56\u5305\uff0c\u63d0\u4f9b\u5b9a\u4e49\u7b49\u5176\u4ed6\u80fd\u529b")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"egg-scripts"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"\u53ef\u9009"),"\uff0cEggJS \u542f\u52a8\u811a\u672c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"@midwayjs/egg-ts-helper"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"\u53ef\u9009"),"\uff0cEggJS \u5b9a\u4e49\u751f\u6210\u5de5\u5177")))),(0,l.kt)("h2",{id:"\u548c\u9ed8\u8ba4-eggjs-\u7684\u4e0d\u540c\u4e4b\u5904"},"\u548c\u9ed8\u8ba4 EggJS \u7684\u4e0d\u540c\u4e4b\u5904"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"1\u3001\u9ed8\u8ba4\u5173\u95ed static \u63d2\u4ef6\uff0c\u9700\u8981\u65f6\u8bf7\u81ea\u884c\u5f00\u542f"),(0,l.kt)("li",{parentName:"ul"},"2\u3001baseDir \u9ed8\u8ba4\u8c03\u6574\u4e3a ",(0,l.kt)("inlineCode",{parentName:"li"},"src"),"\xa0 \u76ee\u5f55\uff0c\u670d\u52a1\u5668\u4e0a\u4e3a ",(0,l.kt)("inlineCode",{parentName:"li"},"dist"),"\xa0 \u76ee\u5f55")),(0,l.kt)("p",null,"\u6574\u4e2a\u67b6\u6784\u5982\u4e0b:"),(0,l.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2021/png/501408/1614842824740-fc0c1432-3ace-4f77-b51f-15212984b168.png#height=828&id=Lv3hN&margin=%5Bobject%20Object%5D&name=image.png&originHeight=828&originWidth=1716&originalType=binary&ratio=1&size=117877&status=done&style=none&width=1716",width:"1716"}),(0,l.kt)("h2",{id:"\u76ee\u5f55\u7ed3\u6784"},"\u76ee\u5f55\u7ed3\u6784"),(0,l.kt)("p",null,"\u9664\u4e86 Midway \u63d0\u4f9b\u7684\u76ee\u5f55\u7ed3\u6784\u5916\uff0cEggJS \u8fd8\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u76ee\u5f55\u7ed3\u6784\uff08\u4e0d\u53ef\u53d8\uff09\uff0c\u6574\u4e2a\u7ed3\u6784\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\u279c  my_midway_app tree\n.\n\u251c\u2500\u2500 src\n|   \u251c\u2500\u2500 app.ts                                                      ## EggJS \u6269\u5c55 Worker \u751f\u547d\u5468\u671f\u6587\u4ef6\uff08\u53ef\u9009\uff09\n|   \u251c\u2500\u2500 agent.ts                                                ## EggJS \u6269\u5c55 Agent \u751f\u547d\u5468\u671f\u6587\u4ef6\uff08\u53ef\u9009\uff09\n|   \u251c\u2500\u2500 app                                                             ## EggJS \u56fa\u5b9a\u7684\u6839\u76ee\u5f55\uff08\u53ef\u9009\uff09\n|   \u2502   \u251c\u2500\u2500 public                                          ## EggJS \u9759\u6001\u6258\u7ba1\u63d2\u4ef6\u7684\u9ed8\u8ba4\u76ee\u5f55\uff08\u53ef\u914d\uff09\n|   \u2502   |   \u2514\u2500\u2500 reset.css\n|   \u2502   \u251c\u2500\u2500 view (\u53ef\u9009)                                        ## EggJS \u6a21\u677f\u6e32\u67d3\u7684\u9ed8\u8ba4\u76ee\u5f55\uff08\u53ef\u914d\uff09\n|   \u2502   |   \u2514\u2500\u2500 home.tpl\n|   \u2502   \u2514\u2500\u2500 extend (\u53ef\u9009)                                  ## EggJS \u6269\u5c55\u76ee\u5f55\uff08\u53ef\u914d\uff09\n|   \u2502       \u251c\u2500\u2500 helper.ts (\u53ef\u9009)\n|   \u2502       \u251c\u2500\u2500 request.ts (\u53ef\u9009)\n|   \u2502       \u251c\u2500\u2500 response.ts (\u53ef\u9009)\n|   \u2502       \u251c\u2500\u2500 context.ts (\u53ef\u9009)\n|   \u2502       \u251c\u2500\u2500 application.ts (\u53ef\u9009)\n|   \u2502       \u2514\u2500\u2500 agent.ts (\u53ef\u9009)\n|   \u2502\n|   \u251c\u2500\u2500 config\n|   |   \u251c\u2500\u2500 plugin.ts\n|   |   \u251c\u2500\u2500 config.default.ts\n|   \u2502   \u251c\u2500\u2500 config.prod.ts\n|   |   \u251c\u2500\u2500 config.test.ts (\u53ef\u9009)\n|   |   \u251c\u2500\u2500 config.local.ts (\u53ef\u9009)\n|   |   \u2514\u2500\u2500 config.unittest.ts (\u53ef\u9009)\n\u2502   \u251c\u2500\u2500 controller                                              ## Midway \u63a7\u5236\u5668\u76ee\u5f55\uff08\u63a8\u8350\uff09\n\u2502   \u251c\u2500\u2500 service                                                 ## Midway \u670d\u52a1\u76ee\u5f55\uff08\u63a8\u8350\uff09\n\u2502   \u2514\u2500\u2500 schedule                                                    ## Midway \u5b9a\u65f6\u5668\u76ee\u5f55\uff08\u63a8\u8350\uff09\n\u2502\n\u251c\u2500\u2500 typings                                     ## EggJS \u5b9a\u4e49\u751f\u6210\u76ee\u5f55\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 tsconfig.json\n")),(0,l.kt)("p",null,"\u4ee5\u4e0a\u662f EggJS \u7684\u76ee\u5f55\u7ed3\u6784\u5168\u8c8c\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5f88\u591a EggJS \u7279\u6709\u7684\u76ee\u5f55\uff0c\u6709\u4e00\u4e9b\u5728 Midway \u4f53\u7cfb\u4e2d\u5df2\u7ecf\u6709\u76f8\u5e94\u7684\u80fd\u529b\u66ff\u4ee3\uff0c\u53ef\u4ee5\u76f4\u63a5\u66ff\u6362\u3002\u6574\u4e2a\u7ed3\u6784\uff0c\u57fa\u672c\u4e0a\u7b49\u4ef7\u4e8e\u5c06 EggJS \u7684\u76ee\u5f55\u7ed3\u6784\u79fb\u52a8\u5230\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"src"),"\xa0 \u76ee\u5f55\u4e0b\u3002"),(0,l.kt)("p",null,"\u7531\u4e8e EggJS \u662f\u57fa\u4e8e\u7ea6\u5b9a\u7684\u6846\u67b6\uff0c\u6574\u4e2a\u5de5\u7a0b\u7684\u76ee\u5f55\u7ed3\u6784\u662f\u56fa\u5b9a\u7684\uff0c\u8fd9\u91cc\u5217\u4e3e\u4e00\u4e9b\u5e38\u7528\u7684\u7ea6\u5b9a\u76ee\u5f55\u3002"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"th"},"src/app/public/**"),"\xa0"),(0,l.kt)("th",{parentName:"tr",align:null},"\u7528\u4e8e\u653e\u7f6e\u9759\u6001\u8d44\u6e90\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1\u5185\u7f6e\u63d2\u4ef6 ",(0,l.kt)("a",{parentName:"th",href:"https://github.com/eggjs/egg-static"},"egg-static"),"\u3002"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"src/config/config.{env}.ts")),(0,l.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\uff0c\u5177\u4f53\u53c2\u89c1",(0,l.kt)("a",{parentName:"td",href:"https://eggjs.org/zh-cn/basics/config.html"},"\u914d\u7f6e"),"\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"src/config/plugin.js")),(0,l.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u914d\u7f6e\u9700\u8981\u52a0\u8f7d\u7684\u63d2\u4ef6\uff0c\u5177\u4f53\u53c2\u89c1",(0,l.kt)("a",{parentName:"td",href:"https://eggjs.org/zh-cn/basics/plugin.html"},"\u63d2\u4ef6"),"\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"test/**")),(0,l.kt)("td",{parentName:"tr",align:null},"\u5177\u4f53\u53c2\u89c1",(0,l.kt)("a",{parentName:"td",href:"https://eggjs.org/zh-cn/core/unittest.html"},"\u5355\u5143\u6d4b\u8bd5"),"\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"src/app.js")," \u548c ",(0,l.kt)("inlineCode",{parentName:"td"},"src/agent.js")),(0,l.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u81ea\u5b9a\u4e49\u542f\u52a8\u65f6\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1",(0,l.kt)("a",{parentName:"td",href:"https://eggjs.org/zh-cn/basics/app-start.html"},"\u542f\u52a8\u81ea\u5b9a\u4e49"),"\u3002\u5173\u4e8e",(0,l.kt)("inlineCode",{parentName:"td"},"agent.js"),"\u7684\u4f5c\u7528\u53c2\u89c1",(0,l.kt)("a",{parentName:"td",href:"https://eggjs.org/zh-cn/core/cluster-and-ipc.html#agent-%E6%9C%BA%E5%88%B6"},"Agent \u673a\u5236"),"\u3002")))),(0,l.kt)("h2",{id:"\u914d\u7f6e\u5b9a\u4e49"},"\u914d\u7f6e\u5b9a\u4e49"),(0,l.kt)("p",null,"Midway \u5728\u811a\u624b\u67b6\u4e2d\u63d0\u4f9b\u4e86\u6807\u51c6\u7684 EggJS \u7684 TS \u914d\u7f6e\u5199\u6cd5\uff0c\u5176\u4e2d\u5305\u62ec\u4e86\u5b8c\u6574\u7684\u5b9a\u4e49\u548c\u5c5e\u6027\u63d0\u793a\uff0c\u7ed3\u6784\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\n\nimport { EggAppConfig, EggAppInfo, PowerPartial } from 'egg';\n\nexport type DefaultConfig = PowerPartial<EggAppConfig>;\n\nexport default (appInfo: EggAppInfo) => {\n  const config = {} as DefaultConfig;\n\n  // use for cookie sign key, should change to your own and keep security\n  config.keys = appInfo.name + '_1600001669991_8079';\n\n  // add your middleware here\n  config.middleware = [];\n\n  config.security = {\n    csrf: {\n      enable: false,\n    },\n  };\n\n  config.sequelize = {};\n\n  return config;\n};\n")),(0,l.kt)("p",null,"\u901a\u8fc7\u8fd9\u6837\u8fd4\u56de\u65b9\u6cd5\u7684\u5f62\u5f0f\uff0c\u5728\u8fd0\u884c\u671f\u4f1a\u88ab\u81ea\u52a8\u6267\u884c\uff0c\u5408\u5e76\u8fdb\u5b8c\u6574\u7684\u914d\u7f6e\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u7684\u53c2\u6570\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"EggAppInfo")," \u7c7b\u578b\uff0c\u503c\u4e3a\u4ee5\u4e0b\u5185\u5bb9\u3002"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"appInfo")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u8bf4\u660e")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"pkg"),(0,l.kt)("td",{parentName:"tr",align:null},"package.json")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"name"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5e94\u7528\u540d\uff0c\u540c pkg.name")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"baseDir"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5e94\u7528\u4ee3\u7801\u7684 src \uff08\u672c\u5730\u5f00\u53d1\uff09\u6216\u8005 dist \uff08\u4e0a\u7ebf\u540e\uff09\u76ee\u5f55")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"appDir"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5e94\u7528\u4ee3\u7801\u7684\u76ee\u5f55")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"HOME"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7528\u6237\u76ee\u5f55\uff0c\u5982 admin \u8d26\u6237\u4e3a /home/admin")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"root"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5e94\u7528\u6839\u76ee\u5f55\uff0c\u53ea\u6709\u5728 local \u548c unittest \u73af\u5883\u4e0b\u4e3a baseDir\uff0c\u5176\u4ed6\u90fd\u4e3a HOME\u3002")))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"baseDir")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"appDir")," \u548c EggJS \u5e94\u7528\u6709\u6240\u533a\u522b\u3002")),(0,l.kt)("h2",{id:"\u63d2\u4ef6"},"\u63d2\u4ef6"),(0,l.kt)("p",null,"\u63d2\u4ef6\u662f EggJS \u7684\u7279\u8272\u4e4b\u4e00\uff0cMidway \u4e5f\u652f\u6301 EggJS \u7684\u63d2\u4ef6\u4f53\u7cfb\u3002"),(0,l.kt)("h3",{id:"\u5f00\u542f\u63d2\u4ef6"},"\u5f00\u542f\u63d2\u4ef6"),(0,l.kt)("p",null,"\u63d2\u4ef6\u4e00\u822c\u901a\u8fc7 npm \u6a21\u5757\u7684\u65b9\u5f0f\u8fdb\u884c\u590d\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm i egg-mysql --save\n")),(0,l.kt)("p",null,"\u7136\u540e\u9700\u8981\u5728\u5e94\u7528\u6216\u6846\u67b6\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/config/plugin.js")," \u4e2d\u58f0\u660e\u5f00\u542f\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"export default"),"\xa0\uff0c\u8bf7\u5199\u5728\u5176\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { EggPlugin } from 'egg';\nexport default {\n  static: false, // default is true\n  mysql: {\n    enable: true,\n    package: 'egg-mysql',\n  },\n} as EggPlugin;\n")),(0,l.kt)("p",null,"\u5982\u679c\u6ca1\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"export default"),"\xa0\uff0c\u53ef\u4ee5\u76f4\u63a5\u5bfc\u51fa\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/plugin.ts\n// \u4f7f\u7528 mysql \u63d2\u4ef6\nexport const mysql = {\n  enable: true,\n  package: 'egg-mysql',\n};\n")),(0,l.kt)("h3",{id:"\u4f7f\u7528\u63d2\u4ef6"},"\u4f7f\u7528\u63d2\u4ef6"),(0,l.kt)("p",null,"\u5728\u5f00\u542f\u63d2\u4ef6\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u4f7f\u7528\u63d2\u4ef6\u63d0\u4f9b\u7684\u529f\u80fd\u4e86\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u63d2\u4ef6\u4f1a\u5c06\u5bf9\u8c61\u6302\u8f7d\u5230 EggJS \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"app"),"\xa0 \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx"),"\xa0 \u4e4b\u4e0a\uff0c\u7136\u540e\u76f4\u63a5\u4f7f\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"app.mysql.query(sql, values); // egg \u63d0\u4f9b\u7684\u65b9\u6cd5\n")),(0,l.kt)("p",null,"\u5728 Midway \u4e2d\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"@App"),"\xa0 \u83b7\u53d6 ",(0,l.kt)("inlineCode",{parentName:"p"},"app"),"\xa0 \u5bf9\u8c61\uff0c\u4ee5\u53ca\u5728\u8bf7\u6c42\u4f5c\u7528\u57df\u4e2d\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"@Inject() ctx"),"\xa0 \u83b7\u53d6 ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx"),"\xa0 \u5bf9\u8c61\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6ce8\u5165\u6765\u83b7\u53d6\u63d2\u4ef6\u5bf9\u8c61\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Inject, Get } from '@midwayjs/decorator';\nimport { Application, Context } from 'egg';\n\n@Provide()\nexport class HomeController {\n  @App()\n  app: Application;\n\n  @Inject()\n  ctx: Context;\n\n  @Get('/')\n  async home() {\n    this.app.mysql.query(sql, values); // \u8c03\u7528 app \u4e0a\u7684\u65b9\u6cd5\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\n    this.ctx.mysql.query(sql, values); // \u8c03\u7528\u6302\u8f7d\u5728 ctx \u4e0a\u7684\u65b9\u6cd5\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\n  }\n}\n")),(0,l.kt)("p",null,"\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"@Plugin"),"\xa0 \u88c5\u9970\u5668\u6765\u76f4\u63a5\u6ce8\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"app"),"\xa0 \u6302\u8f7d\u7684\u63d2\u4ef6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e0d\u4f20\u53c2\u6570\uff0c\u5c06\u4ee5\u5c5e\u6027\u540d\u4f5c\u4e3a key\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Get, Plugin } from '@midwayjs/decorator';\n\n@Provide()\nexport class HomeController {\n  @Plugin()\n  mysql: any;\n\n  @Get('/')\n  async home() {\n    this.mysql.query(sql, values);\n  }\n}\n")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"@Plugin() mysql"),"\xa0 \u7b49\u4ef7\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"app.mysql"),"\xa0\u3002 ",(0,l.kt)("inlineCode",{parentName:"p"},"@Plugin"),"\xa0 \u7684\u4f5c\u7528\u5c31\u662f\u4ece app \u5bf9\u8c61\u4e0a\u62ff\u5bf9\u5e94\u5c5e\u6027\u540d\u7684\u63d2\u4ef6\uff0c\u6240\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"@Plugin() xxx"),"\xa0 \u5c31\u7b49\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"app['xxx']"),"\xa0\u3002")),(0,l.kt)("h2",{id:"web-\u4e2d\u95f4\u4ef6"},"Web \u4e2d\u95f4\u4ef6"),(0,l.kt)("p",null,"\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/middleware")," \u6587\u4ef6\u5939\u4e2d\u7f16\u5199 Web \u4e2d\u95f4\u4ef6\uff0c\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"src/middleware/report.ts")," \u3002\u6211\u4eec\u5728\u8fd9\u4e2a Web \u4e2d\u95f4\u4ef6\u4e2d\u6253\u5370\u4e86\u63a7\u5236\u5668\uff08Controller\uff09\u6267\u884c\u7684\u65f6\u95f4\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\u279c  my_midway_app tree\n.\n\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u251c\u2500\u2500 user.ts\n\u2502   \u2502   \u2514\u2500\u2500 home.ts\n\u2502   \u251c\u2500\u2500 interface.ts\n\u2502   \u251c\u2500\u2500 middleware                   ## \u4e2d\u95f4\u4ef6\u76ee\u5f55\n\u2502   \u2502   \u2514\u2500\u2500 report.ts\n\u2502   \u2514\u2500\u2500 service\n\u2502       \u2514\u2500\u2500 user.ts\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 tsconfig.json\n")),(0,l.kt)("p",null,"\u7b80\u5355\u6765\u8bf4\uff0c ",(0,l.kt)("inlineCode",{parentName:"p"},"await next()")," \u5219\u4ee3\u8868\u4e86\u4e0b\u4e00\u4e2a\u8981\u6267\u884c\u7684\u903b\u8f91\uff0c\u8fd9\u91cc\u4e00\u822c\u4ee3\u8868\u63a7\u5236\u5668\u6267\u884c\uff0c\u5728\u6267\u884c\u7684\u524d\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u6253\u5370\u548c\u8d4b\u503c\u64cd\u4f5c\uff0c\u8fd9\u4e5f\u662f\u6d0b\u8471\u5708\u6a21\u578b\u6700\u5927\u7684\u4f18\u52bf\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide } from '@midwayjs/decorator';\nimport { IWebMiddleware, IMidwayWebNext } from '@midwayjs/web';\nimport { Context } from 'egg';\n\n@Provide()\nexport class ReportMiddleware implements IWebMiddleware {\n  resolve() {\n    return async (ctx: Context, next: IMidwayWebNext) => {\n      const startTime = Date.now();\n      await next();\n      console.log(Date.now() - startTime);\n    };\n  }\n}\n")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u6ce8\u610f\uff0c\u5982\u679c\u8981\u7ee7\u7eed\u4f7f\u7528 EggJS \u4f20\u7edf\u7684\u51fd\u6570\u5f0f\u5199\u6cd5\uff0c\u5fc5\u987b\u5c06\u6587\u4ef6\u653e\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/app/middleware"),"\xa0 \u4e0b\u3002")),(0,l.kt)("h3",{id:"\u914d\u7f6e\u5168\u5c40\u4e2d\u95f4\u4ef6"},"\u914d\u7f6e\u5168\u5c40\u4e2d\u95f4\u4ef6"),(0,l.kt)("p",null,"\u5728 EggJS \u4e2d\uff0c\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u5168\u5c40\u4e2d\u95f4\u4ef6\u4f7f\u7528\u65b9\u6cd5\u5916\uff0c\u5176\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u4e3a\u914d\u7f6e\u6027\u7684\u52a0\u8f7d\u5168\u5c40\u4e2d\u95f4\u4ef6\u7684\u7528\u6cd5\u3002\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/config/config.default.ts")," \u4e2d\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"middleware")," \u5c5e\u6027\u5373\u53ef\u5b9a\u4e49\u5168\u5c40\u4e2d\u95f4\u4ef6\uff0c\u540c\u6837\u7684\uff0c\u6307\u5b9a\u5168\u5c40\u4e2d\u95f4\u4ef6\u7684 key \u5373\u53ef\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\n\nexport default (appInfo: EggAppInfo) => {\n  const config = {} as DefaultConfig;\n\n  // ...\n\n  config.middleware = ['reportMiddleware'];\n\n  return config;\n};\n")),(0,l.kt)("h3",{id:"\u914d\u7f6e\u8def\u7531\u4e2d\u95f4\u4ef6"},"\u914d\u7f6e\u8def\u7531\u4e2d\u95f4\u4ef6"),(0,l.kt)("p",null,"\u6309\u7167 Midway \u7684\u901a\u7528\u7684\u914d\u7f6e\u5728\u8def\u7531\u88c5\u9970\u5668\u5373\u53ef\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Provide } from '@midwayjs/decorator';\n\n@Provide()\n@Controller('/', { middleware: ['reportMiddleware'] }) // controller \u7ea7\u522b\u7684\u4e2d\u95f4\u4ef6\nexport class HomeController {\n  @Get('/', { middleware: ['reportMiddleware'] }) // \u8def\u7531\u7ea7\u522b\u7684\u4e2d\u95f4\u4ef6\n  async home() {}\n}\n")),(0,l.kt)("h3",{id:"\u5173\u4e8e-match-\u548c-ignore"},"\u5173\u4e8e Match \u548c Ignore"),(0,l.kt)("p",null,"EggJS \u7684\u4e2d\u95f4\u4ef6\u652f\u6301\u5728 config \u4e2d\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"match"),"\xa0 \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"ignore"),"\xa0\uff0c\u5728 Midway \u4e2d\uff0c\u8fd9\u4e00\u7279\u6027\u53ea\u4f1a\u5bf9 EggJS \u81ea\u5df1\u7684\u4e2d\u95f4\u4ef6\u751f\u6548\uff0c\u5373\u53ea\u5bf9 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/app/middleware"),"\xa0 \u91cc\u7684\u51fd\u6570\u5199\u6cd5\u751f\u6548\u3002"),(0,l.kt)("h2",{id:"\u6a21\u677f\u6e32\u67d3"},"\u6a21\u677f\u6e32\u67d3"),(0,l.kt)("p",null,"EggJS \u9ed8\u8ba4\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"egg-view"),"\xa0 \u63d0\u4f9b\u9ed8\u8ba4\u6e32\u67d3\u7684\u80fd\u529b\uff0c\u4ed6\u9ed8\u8ba4\u7684\u6a21\u677f\u76ee\u5f55\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"app/view"),"\xa0\uff0c\u5728 Midway \u4e2d\u76ee\u524d\u6ca1\u6709\u5bf9\u6b64\u505a\u8c03\u6574\uff0c\u6240\u4ee5\u76f8\u5e94\u7684\uff0cview \u76ee\u5f55\u9700\u8981\u653e\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/app/view"),"\xa0 \u4e0b\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u76ee\u5f55\u7ed3\u6784\u4e0d\u662f\u5f88\u559c\u6b22\uff0c\u53ef\u4ee5\u5728\u914d\u7f6e\u4e2d\u4fee\u6539\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\n\nmodule.exports = (appInfo) => {\n  return {\n    view: {\n      root: path.join(appInfo.baseDir, 'view'),\n    },\n  };\n};\n")),(0,l.kt)("h2",{id:"\u6587\u4ef6\u4e0a\u4f20"},"\u6587\u4ef6\u4e0a\u4f20"),(0,l.kt)("p",null,"Egg.js \u4f7f\u7528 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/eggjs/egg-multipart"},"egg-multipart")," \u63d2\u4ef6\u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20\u5904\u7406\u3002"),(0,l.kt)("h3",{id:"file-\u6a21\u5f0f"},"File \u6a21\u5f0f"),(0,l.kt)("p",null,"\u5728 config \u6587\u4ef6\u4e2d\u542f\u7528 file \u6a21\u5f0f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexports.multipart = {\n  mode: 'file',\n};\n")),(0,l.kt)("p",null,"1\u3001\u4e0a\u4f20 / \u63a5\u6536\u6587\u4ef6"),(0,l.kt)("p",null,"\u4f60\u7684\u524d\u7aef\u9759\u6001\u9875\u9762\u4ee3\u7801\u7c7b\u4f3c\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},'<form method="POST" action="/api/upload?_csrf={{ ctx.csrf | safe }}" enctype="multipart/form-data">\n  title: <input name="title" />\n  file: <input name="file" type="file" />\n  <button type="submit">Upload</button>\n</form>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// controller/upload.ts\nconst fs = require('mz/fs');\nimport { basename } from 'path';\nimport { Context } from 'egg';\n\n@Controller('/api')\nexport class ApiController {\n  @Inject()\n  ctx: Context;\n\n  @Post('/upload')\n  async uplaodFile() {\n    const file = this.ctx.request.files[0];\n    const name = 'egg-multipart-test/' + basename(file.filename);\n    let result;\n    try {\n      // \u5904\u7406\u6587\u4ef6\uff0c\u6bd4\u5982\u4e0a\u4f20\u5230\u4e91\u7aef\n      result = await this.ctx.oss.put(name, file.filepath);\n    } finally {\n      // \u9700\u8981\u5220\u9664\u4e34\u65f6\u6587\u4ef6\n      await fs.unlink(file.filepath);\n    }\n\n    return {\n      url: result.url,\n      // \u83b7\u53d6\u6240\u6709\u7684\u5b57\u6bb5\u503c\n      requestBody: ctx.request.body,\n    };\n  }\n}\n")),(0,l.kt)("p",null,"2\u3001\u4e0a\u4f20 / \u63a5\u6536\u591a\u4e2a\u6587\u4ef6\uff1a"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u591a\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u501f\u52a9 ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.request.files")," \u5c5e\u6027\u8fdb\u884c\u904d\u5386\uff0c\u7136\u540e\u5206\u522b\u8fdb\u884c\u5904\u7406\uff1a\n\u4f60\u7684\u524d\u7aef\u9759\u6001\u9875\u9762\u4ee3\u7801\u5e94\u8be5\u770b\u4e0a\u53bb\u5982\u4e0b\u6837\u5b50\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},'<form method="POST" action="/api/upload?_csrf={{ ctx.csrf | safe }}" enctype="multipart/form-data">\n  title: <input name="title" />\n  file1: <input name="file1" type="file" />\n  file2: <input name="file2" type="file" />\n  <button type="submit">Upload</button>\n</form>\n')),(0,l.kt)("p",null,"\u5bf9\u5e94\u7684\u540e\u7aef\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// controller/upload.ts\nconst fs = require('mz/fs');\nimport { basename } from 'path';\nimport { Context } from 'egg';\n\n@Controller('/api')\nexport class ApiController {\n  @Inject()\n  ctx: Context;\n\n  @Post('/upload')\n  async uplaodFile() {\n    console.log('got %d files', this.ctx.request.files.length);\n    for (const file of this.ctx.request.files) {\n      console.log('field: ' + file.fieldname);\n      console.log('filename: ' + file.filename);\n      console.log('encoding: ' + file.encoding);\n      console.log('mime: ' + file.mime);\n      console.log('tmp filepath: ' + file.filepath);\n      let result;\n      try {\n        // \u5904\u7406\u6587\u4ef6\uff0c\u6bd4\u5982\u4e0a\u4f20\u5230\u4e91\u7aef\n        result = await this.ctx.oss.put('egg-multipart-test/' + file.filename, file.filepath);\n      } finally {\n        // \u9700\u8981\u5220\u9664\u4e34\u65f6\u6587\u4ef6\n        await fs.unlink(file.filepath);\n      }\n      console.log(result);\n    }\n\n    return {\n      url: result.url,\n      // \u83b7\u53d6\u6240\u6709\u7684\u5b57\u6bb5\u503c\n      requestBody: ctx.request.body,\n    };\n  }\n}\n")),(0,l.kt)("p",null,"\u9664\u4e86\u7b80\u5355\u7684\u6587\u4ef6\u4e0a\u4f20\uff0c\u8fd8\u6709\u66f4\u52a0\u590d\u6742\u7684\u6d41\u5f0f\u4e0a\u4f20\uff0c\u53ef\u4ee5\u53c2\u8003",(0,l.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6"}," egg \u6587\u4ef6\u4e0a\u4f20"),"\u3002"),(0,l.kt)("h2",{id:"\u9759\u6001\u6587\u4ef6"},"\u9759\u6001\u6587\u4ef6"),(0,l.kt)("p",null,"\u8bf7\u4f7f\u7528 egg \u81ea\u5e26\u7684\u9759\u6001\u65b9\u6848\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/tutorials/assets.html"},"https://eggjs.org/zh-cn/tutorials/assets.html"),"\u3002"),(0,l.kt)("h2",{id:"\u5b9a\u65f6\u4efb\u52a1"},"\u5b9a\u65f6\u4efb\u52a1"),(0,l.kt)("p",null,"midway \u7684\u5b9a\u65f6\u4efb\u52a1\u662f\u57fa\u4e8e ",(0,l.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/basics/schedule.html"},"egg \u5b9a\u65f6\u4efb\u52a1")," \u63d0\u4f9b\u4e86\u66f4\u591a TypeScript \u4ee5\u53ca\u88c5\u9970\u5668\u65b9\u9762\u7684\u652f\u6301\u3002"),(0,l.kt)("h3",{id:"\u7f16\u5199\u4ee3\u7801"},"\u7f16\u5199\u4ee3\u7801"),(0,l.kt)("p",null,"\u5b9a\u65f6\u4efb\u52a1\u4e00\u822c\u5b58\u653e\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/schedule"),"\xa0 \u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\u7684\u5c5e\u6027\u548c\u8981\u6267\u884c\u7684\u65b9\u6cd5\u3002\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/schedule/hello.ts\nimport { Provide, Inject, Schedule, CommonSchedule } from '@midwayjs/decorator';\nimport { Context } from 'egg';\n\n@Provide()\n@Schedule({\n  interval: 2333, // 2.333s \u95f4\u9694\n  type: 'worker', // \u6307\u5b9a\u67d0\u4e00\u4e2a worker \u6267\u884c\n})\nexport class HelloCron implements CommonSchedule {\n  @Inject()\n  ctx: Context;\n\n  // \u5b9a\u65f6\u6267\u884c\u7684\u5177\u4f53\u4efb\u52a1\n  async exec() {\n    this.ctx.logger.info(process.pid, 'hello');\n  }\n}\n")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u63a8\u8350\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"CommonSchedule")," \u63a5\u53e3\u6765\u89c4\u8303\u4f60\u7684\u8ba1\u5212\u4efb\u52a1\u7c7b\u3002")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u8bf7\u4e0d\u8981\u653e\u5230 src/app/schedule \u4e2d\uff0c\u4f1a\u548c egg \u672c\u8eab\u7684\u52a0\u8f7d\u51b2\u7a81\u3002")),(0,l.kt)("h3",{id:"\u624b\u52a8\u8c03\u7528"},"\u624b\u52a8\u8c03\u7528"),(0,l.kt)("p",null,"EggJS \u63d0\u4f9b\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"app.runSchedule"),"\xa0 \u65b9\u6cd5\u6765\u6d4b\u8bd5\u8ba1\u5212\u4efb\u52a1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5728 Midway \u4e0b\u505a\u4e86\u7279\u6b8a\u5904\u7406\uff0c\u53c2\u6570\u7684\u683c\u5f0f\u53d8\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"id#className"),"\xa0\uff0cid \u4e3a\u4f9d\u8d56\u6ce8\u5165\u7684\u6807\u8bc6\u7b26\uff08\u7c7b\u540d\u7684\u9a7c\u5cf0\uff09\u3002"),(0,l.kt)("p",null,"\u793a\u4f8b\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"app.runSchedule('helloCron#HelloCron');\n")),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Midway \u81ea\u8eab\u7684\u52a8\u6001\u83b7\u53d6\u5b9e\u4f8b\u7684\u65b9\u5f0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"const helloCron = await ctx.requestContext.getAsync<HelloCron>('helloCron');\nawait helloCron.exec();\n")),(0,l.kt)("h2",{id:"\u65e5\u5fd7"},"\u65e5\u5fd7"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 Midway \u4e2d\u4f7f\u7528 @mdwayjs/logger\uff0c\u6587\u6863\u8bf7\u53c2\u8003",(0,l.kt)("a",{parentName:"p",href:"logger"},"\u65e5\u5fd7\u7ae0\u8282"),"\u3002\u5728\u4f7f\u7528 egg-logger \u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u91cc\u6216\u8005\u76f4\u63a5",(0,l.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/core/logger.html"},"\u8bbf\u95ee egg \u6587\u6863"),"\u3002"),(0,l.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u65e5\u5fd7"},"\u81ea\u5b9a\u4e49\u65e5\u5fd7"),(0,l.kt)("p",null,"\u6bd4\u5982\u81ea\u5b9a\u4e49\u4e00\u4e2a\u65e5\u5fd7 ",(0,l.kt)("inlineCode",{parentName:"p"},"myLogger"),"\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u65e5\u5fd7\u7684 key \u5219\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"myLogger")," \u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"module.exports = (appInfo) => {\n  return {\n    customLogger: {\n      myLogger: {\n        file: path.join(appInfo.root, 'logs/xx.log'),\n      },\n    },\n  };\n};\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"@Logger")," \u88c5\u9970\u5668\u6765\u83b7\u53d6\u65e5\u5fd7\u5b9e\u4f8b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Provide, Logger } from '@midwayjs/decorator';\n\n@Provide()\nexport class BaseService {\n  @Logger('myLogger')\n  logger;\n}\n")),(0,l.kt)("h3",{id:"\u65e5\u5fd7\u7b49\u7ea7"},"\u65e5\u5fd7\u7b49\u7ea7"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cEggJS \u7684\u65e5\u5fd7\u7b49\u7ea7\u5747\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"WARN"),"\xa0\uff0c\u6211\u4eec\u53ef\u4ee5\u4fee\u6539 EggJS \u9ed8\u8ba4\u7684\u65e5\u5fd7\u7b49\u7ea7\u8986\u76d6\u8fd9\u4e00\u884c\u4e3a\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.local.ts\nexport const logger = {\n  consoleLevel: 'INFO',\n  coreLogger: {\n    consoleLevel: 'INFO',\n  },\n};\n")),(0,l.kt)("h3",{id:"\u9ed8\u8ba4\u65e5\u5fd7\u540d"},"\u9ed8\u8ba4\u65e5\u5fd7\u540d"),(0,l.kt)("p",null,"Midway \u5bf9 EggJS \u9ed8\u8ba4\u7684\u65e5\u5fd7\u6587\u4ef6\u540d\u505a\u4e86\u4fee\u6539\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"midway-core.log"),"\xa0 \u6846\u67b6\u8f93\u5165\u65e5\u5fd7"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"midway-web.log"),"\xa0 \u5e94\u7528\u8f93\u51fa\u65e5\u5fd7"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"midway-agent.log"),"\xa0agent \u4e2d\u8f93\u51fa\u7684\u65e5\u5fd7"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"common-error.log"),"\xa0 \u7edf\u4e00\u7684\u9519\u8bef\u8f93\u51fa\u65e5\u5fd7")),(0,l.kt)("h3",{id:"\u670d\u52a1\u5668\u65e5\u5fd7"},"\u670d\u52a1\u5668\u65e5\u5fd7"),(0,l.kt)("p",null,"EggJS \u9ed8\u8ba4\u5f00\u542f\u4e86\u65e5\u5fd7\u6e05\u7406\uff0c\u65e5\u5fd7\u6587\u4ef6",(0,l.kt)("strong",{parentName:"p"},"\u6700\u591a\u4fdd\u5b58\u4e00\u4e2a\u6708"),"\uff0c\u8981\u4fee\u6539\u8fd9\u4e00\u884c\u4e3a\uff0c\u53ef\u4ee5\u8fdb\u884c\u914d\u7f6e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},"// config.default.ts\nexports.logrotator = {\n  // for clean_log\n  maxDays: 0,\n};\n")),(0,l.kt)("h2",{id:"\u5f02\u5e38\u5904\u7406"},"\u5f02\u5e38\u5904\u7406"),(0,l.kt)("p",null,"EggJS \u6846\u67b6\u901a\u8fc7 \xa0",(0,l.kt)("a",{parentName:"p",href:"https://github.com/eggjs/egg-onerror"},"onerror"),"\xa0 \u63d2\u4ef6\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u3002\u5bf9\u4e00\u4e2a\u8bf7\u6c42\u7684\u6240\u6709\u5904\u7406\u65b9\u6cd5\uff08Middleware\u3001Controller\u3001Service\uff09\u4e2d\u629b\u51fa\u7684\u4efb\u4f55\u5f02\u5e38\u90fd\u4f1a\u88ab\u5b83\u6355\u83b7\uff0c\u5e76\u81ea\u52a8\u6839\u636e\u8bf7\u6c42\u60f3\u8981\u83b7\u53d6\u7684\u7c7b\u578b\u8fd4\u56de\u4e0d\u540c\u7c7b\u578b\u7684\u9519\u8bef\uff08\u57fa\u4e8e \xa0",(0,l.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7231#section-5.3.2"},"Content Negotiation"),"\uff09\u3002"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u8bf7\u6c42\u9700\u6c42\u7684\u683c\u5f0f"),(0,l.kt)("th",{parentName:"tr",align:null},"\u73af\u5883"),(0,l.kt)("th",{parentName:"tr",align:null},"errorPageUrl \u662f\u5426\u914d\u7f6e"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8fd4\u56de\u5185\u5bb9"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"HTML & TEXT"),(0,l.kt)("td",{parentName:"tr",align:null},"local & unittest"),(0,l.kt)("td",{parentName:"tr",align:null},"-"),(0,l.kt)("td",{parentName:"tr",align:null},"onerror \u81ea\u5e26\u7684\u9519\u8bef\u9875\u9762\uff0c\u5c55\u793a\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"HTML & TEXT"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5176\u4ed6"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u91cd\u5b9a\u5411\u5230 errorPageUrl")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"HTML & TEXT"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5176\u4ed6"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,l.kt)("td",{parentName:"tr",align:null},"onerror \u81ea\u5e26\u7684\u6ca1\u6709\u9519\u8bef\u4fe1\u606f\u7684\u7b80\u5355\u9519\u8bef\u9875\uff08\u4e0d\u63a8\u8350\uff09")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"JSON & JSONP"),(0,l.kt)("td",{parentName:"tr",align:null},"local & unittest"),(0,l.kt)("td",{parentName:"tr",align:null},"-"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON \u5bf9\u8c61\u6216\u5bf9\u5e94\u7684 JSONP \u683c\u5f0f\u54cd\u5e94\uff0c\u5e26\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"JSON & JSONP"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5176\u4ed6"),(0,l.kt)("td",{parentName:"tr",align:null},"-"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON \u5bf9\u8c61\u6216\u5bf9\u5e94\u7684 JSONP \u683c\u5f0f\u54cd\u5e94\uff0c\u4e0d\u5e26\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f")))),(0,l.kt)("h3",{id:"errorpageurl"},"errorPageUrl"),(0,l.kt)("p",null,"onerror \u63d2\u4ef6\u7684\u914d\u7f6e\u4e2d\u652f\u6301 errorPageUrl \u5c5e\u6027\uff0c\u5f53\u914d\u7f6e\u4e86 errorPageUrl \u65f6\uff0c\u4e00\u65e6\u7528\u6237\u8bf7\u6c42\u7ebf\u4e0a\u5e94\u7528\u7684 HTML \u9875\u9762\u5f02\u5e38\uff0c\u5c31\u4f1a\u91cd\u5b9a\u5411\u5230\u8fd9\u4e2a\u5730\u5740\u3002"),(0,l.kt)("p",null,"\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/config/config.default.ts")," \u4e2d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nmodule.exports = {\n  onerror: {\n    // \u7ebf\u4e0a\u9875\u9762\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u91cd\u5b9a\u5411\u5230\u8fd9\u4e2a\u9875\u9762\u4e0a\n    errorPageUrl: '/50x.html',\n  },\n};\n")),(0,l.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406"},"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406"),(0,l.kt)("p",null,"\u5c3d\u7ba1\u6846\u67b6\u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684\u7edf\u4e00\u5f02\u5e38\u5904\u7406\u673a\u5236\uff0c\u4f46\u662f\u5e94\u7528\u5f00\u53d1\u4e2d\u7ecf\u5e38\u9700\u8981\u5bf9\u5f02\u5e38\u65f6\u7684\u54cd\u5e94\u505a\u81ea\u5b9a\u4e49\uff0c\u7279\u522b\u662f\u5728\u505a\u4e00\u4e9b\u63a5\u53e3\u5f00\u53d1\u7684\u65f6\u5019\u3002\u6846\u67b6\u81ea\u5e26\u7684 onerror \u63d2\u4ef6\u652f\u6301\u81ea\u5b9a\u4e49\u914d\u7f6e\u9519\u8bef\u5904\u7406\u65b9\u6cd5\uff0c\u53ef\u4ee5\u8986\u76d6\u9ed8\u8ba4\u7684\u9519\u8bef\u5904\u7406\u65b9\u6cd5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport const onerror = {\n  all(err, ctx) {\n    // \u5728\u6b64\u5904\u5b9a\u4e49\u9488\u5bf9\u6240\u6709\u54cd\u5e94\u7c7b\u578b\u7684\u9519\u8bef\u5904\u7406\u65b9\u6cd5\n    // \u6ce8\u610f\uff0c\u5b9a\u4e49\u4e86 config.all \u4e4b\u540e\uff0c\u5176\u4ed6\u9519\u8bef\u5904\u7406\u65b9\u6cd5\u4e0d\u4f1a\u518d\u751f\u6548\n    ctx.body = 'error';\n    ctx.status = 500;\n  },\n  html(err, ctx) {\n    // html hander\n    ctx.body = '<h3>error</h3>';\n    ctx.status = 500;\n  },\n  json(err, ctx) {\n    // json hander\n    ctx.body = { message: 'error' };\n    ctx.status = 500;\n  },\n  jsonp(err, ctx) {\n    // \u4e00\u822c\u6765\u8bf4\uff0c\u4e0d\u9700\u8981\u7279\u6b8a\u9488\u5bf9 jsonp \u8fdb\u884c\u9519\u8bef\u5b9a\u4e49\uff0cjsonp \u7684\u9519\u8bef\u5904\u7406\u4f1a\u81ea\u52a8\u8c03\u7528 json \u9519\u8bef\u5904\u7406\uff0c\u5e76\u5305\u88c5\u6210 jsonp \u7684\u54cd\u5e94\u683c\u5f0f\n  },\n};\n")),(0,l.kt)("h3",{id:"404"},"404"),(0,l.kt)("p",null,"\u6846\u67b6\u5e76\u4e0d\u4f1a\u5c06\u670d\u52a1\u7aef\u8fd4\u56de\u7684 404 \u72b6\u6001\u5f53\u505a\u5f02\u5e38\u6765\u5904\u7406\uff0c\u4f46\u662f\u6846\u67b6\u63d0\u4f9b\u4e86\u5f53\u54cd\u5e94\u4e3a 404 \u4e14\u6ca1\u6709\u8fd4\u56de body \u65f6\u7684\u9ed8\u8ba4\u54cd\u5e94\u3002"),(0,l.kt)("p",null,"\u5f53\u8bf7\u6c42\u88ab\u6846\u67b6\u5224\u5b9a\u4e3a\u9700\u8981 JSON \u683c\u5f0f\u7684\u54cd\u5e94\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u6bb5 JSON\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{ "message": "Not Found" }\n')),(0,l.kt)("p",null,"\u5f53\u8bf7\u6c42\u88ab\u6846\u67b6\u5224\u5b9a\u4e3a\u9700\u8981 HTML \u683c\u5f0f\u7684\u54cd\u5e94\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u6bb5 HTML\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<h1>404 Not Found</h1>\n")),(0,l.kt)("p",null,"\u6846\u67b6\u652f\u6301\u901a\u8fc7\u914d\u7f6e\uff0c\u5c06\u9ed8\u8ba4\u7684 HTML \u8bf7\u6c42\u7684 404 \u54cd\u5e94\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684\u9875\u9762\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport const notfound = {\n  pageUrl: '/404.html',\n};\n")),(0,l.kt)("h3",{id:"\u81ea\u5b9a\u4e49-404-\u54cd\u5e94"},"\u81ea\u5b9a\u4e49 404 \u54cd\u5e94"),(0,l.kt)("p",null,"\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u670d\u52a1\u5668 404 \u65f6\u7684\u54cd\u5e94\uff0c\u548c\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u4e00\u6837\uff0c\u6211\u4eec\u4e5f\u53ea\u9700\u8981\u52a0\u5165\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u5373\u53ef\u5bf9 404 \u505a\u7edf\u4e00\u5904\u7406\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/middleware/notfound_handler.ts\n\nimport { Provide } from '@midwayjs/decorator';\n\n@Provide('notfoundHandler')\nexport class NotFoundHandlerMiddleware {\n  resolve() {\n    return async function notFoundHandler(ctx, next) {\n      await next();\n      if (ctx.status === 404 && !ctx.body) {\n        if (ctx.acceptJSON) {\n          ctx.body = { error: 'Not Found' };\n        } else {\n          ctx.body = '<h1>Page Not Found</h1>';\n        }\n      }\n    };\n  }\n}\n")),(0,l.kt)("p",null,"\u7136\u540e\u5728\u914d\u7f6e\u4e2d\u5f15\u5165\u4e2d\u95f4\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport const middleware = ['notfoundHandler'];\n")),(0,l.kt)("h2",{id:"\u4e0d\u5b58\u5728\u5b9a\u4e49\u7684\u95ee\u9898"},"\u4e0d\u5b58\u5728\u5b9a\u4e49\u7684\u95ee\u9898"),(0,l.kt)("p",null,"\u4e00\u4e9b egg \u63d2\u4ef6\u672a\u63d0\u4f9b ts \u5b9a\u4e49\uff0c\u5bfc\u81f4\u4f7f\u7528\u4f1a\u51fa\u73b0\u672a\u58f0\u660e\u65b9\u6cd5\u7684\u60c5\u51b5\uff0c\u6bd4\u5982 egg-mysql\u3002"),(0,l.kt)("img",{src:"https://cdn.nlark.com/yuque/0/2021/png/501408/1623158462288-d55fc0ff-dcc3-4c58-b952-101a552efe12.png#clientId=u9825f56d-757f-4&from=paste&height=438&id=uec9c4ff6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=876&originWidth=1478&originalType=binary&ratio=2&size=581313&status=done&style=none&taskId=ubcf947b0-1a9d-43b5-9b57-f678da05da9&width=739",width:"739"}),(0,l.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 any \u7ed5\u8fc7\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"await(this.app as any).mysql.query(sql);\n")),(0,l.kt)("p",null,"\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u589e\u52a0\u6269\u5c55\u5b9a\u4e49\u3002"),(0,l.kt)("h2",{id:"\u6269\u5c55-applicationcontextrequestresponse"},"\u6269\u5c55 Application/Context/Request/Response"),(0,l.kt)("h3",{id:"\u589e\u52a0\u6269\u5c55\u6587\u4ef6"},"\u589e\u52a0\u6269\u5c55\u6587\u4ef6"),(0,l.kt)("p",null,"\u867d\u7136 MidwayJS \u5e76\u4e0d\u5e0c\u671b\u76f4\u63a5\u5c06\u5c5e\u6027\u6302\u8f7d\u5230 koa \u7684 Context\uff0cApp \u4e0a\uff08\u4f1a\u9020\u6210\u7ba1\u7406\u548c\u5b9a\u4e49\u7684\u4e0d\u786e\u5b9a\u6027\uff09\uff0c\u4f46\u662f EggJS \u7684\u8fd9\u9879\u529f\u80fd\u4f9d\u65e7\u53ef\u7528\u3002"),(0,l.kt)("p",null,"\u6587\u4ef6\u4f4d\u7f6e\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\u279c  my_midway_app tree\n.\n\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 app\n\u2502   \u2502   \u2514\u2500\u2500 extend\n\u2502   \u2502       \u251c\u2500\u2500 application.ts\n\u2502   \u2502       \u251c\u2500\u2500 context.ts\n\u2502   \u2502       \u251c\u2500\u2500 request.ts\n\u2502   \u2502       \u2514\u2500\u2500 response.ts\n\u2502   \u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 interface.ts\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 tsconfig.json\n")),(0,l.kt)("p",null,"\u5185\u5bb9\u548c\u539f\u6765\u7684 EggJS \u76f8\u540c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/app/extend/context.ts\nexport default {\n  get hello() {\n    return 'hello world';\n  },\n};\n")),(0,l.kt)("h3",{id:"\u589e\u52a0\u6269\u5c55\u5b9a\u4e49"},"\u589e\u52a0\u6269\u5c55\u5b9a\u4e49"),(0,l.kt)("p",null,"\u6269\u5c55\u4e86 EggJS \u4e4b\u540e\uff0c\u4f60\u9700\u8981\u589e\u52a0\u6269\u5c55\u7684\u5b9a\u4e49\u3002\u8bf7\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/interface.ts"),"\xa0 \u4e2d\u6269\u5c55\u589e\u52a0\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.hello"),"\xa0 \u5c5e\u6027\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/interface.ts\ndeclare module 'egg' {\n  interface Context {\n    hello: string;\n  }\n}\n")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u4e1a\u52a1\u81ea\u5b9a\u4e49\u6269\u5c55\u7684\u5b9a\u4e49\u8bf7 ",(0,l.kt)("strong",{parentName:"p"},"\u4e0d\u8981\u653e\u5728\u6839\u76ee\u5f55")," ",(0,l.kt)("inlineCode",{parentName:"p"},"typings"),"\xa0 \u4e0b\uff0c\u907f\u514d\u88ab ts-helper \u5de5\u5177\u8986\u76d6\u6389\u3002")),(0,l.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u6269\u5c55\u5176\u4ed6\u7684\u5b9a\u4e49\uff0cMidwayJS \u7684\u76f8\u5173\u65b9\u6cd5\u4e5f\u662f\u5982\u6b64\u652f\u6301\u7684\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"declare module 'egg' {\n  interface EggAppInfo {\n    // \u6269\u5c55 eggInfo\n    appDir: string;\n  }\n\n  interface Application {\n    // \u6269\u5c55 Application\n    applicationContext: IMidwayContainer;\n    getBaseDir(): string;\n    getAppDir(): string;\n    getEnv(): string;\n    getFrameworkType(): MidwayFrameworkType;\n    getProcessType(): MidwayProcessTypeEnum;\n    getApplicationContext(): IMidwayContainer;\n    getConfig(key?: string): any;\n    generateController?(controllerMapping: string);\n    generateMiddleware?(middlewareId: string): Promise<Middleware<DefaultState, IMidwayKoaContext>>;\n  }\n\n  interface Context {\n    // \u6269\u5c55 Context\n    requestContext: IMidwayContainer;\n  }\n}\n")),(0,l.kt)("h2",{id:"\u6846\u67b6\u542f\u52a8\u53c2\u6570"},"\u6846\u67b6\u542f\u52a8\u53c2\u6570"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"@midwayjs/web"),"\xa0 \u6846\u67b6\u7684\u542f\u52a8\u53c2\u6570\u5982\u4e0b\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"port"),(0,l.kt)("th",{parentName:"tr",align:null},"number"),(0,l.kt)("th",{parentName:"tr",align:null},"\u5fc5\u586b\uff0c\u542f\u52a8\u7684\u7aef\u53e3"),(0,l.kt)("th",{parentName:"tr",align:null}),(0,l.kt)("th",{parentName:"tr",align:null}),(0,l.kt)("th",{parentName:"tr",align:null}))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"key"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"Buffer"),(0,l.kt)("td",{parentName:"tr",align:null},"Array<Buffer"),(0,l.kt)("td",{parentName:"tr",align:null},"Object>"),(0,l.kt)("td",{parentName:"tr",align:null},"\u53ef\u9009\uff0cHTTPS \u8bc1\u4e66 key")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"cert"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"Buffer"),(0,l.kt)("td",{parentName:"tr",align:null},"Array<Buffer"),(0,l.kt)("td",{parentName:"tr",align:null},"Object>"),(0,l.kt)("td",{parentName:"tr",align:null},"\u53ef\u9009\uff0cHTTPS \u8bc1\u4e66 cert")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ca"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"Buffer"),(0,l.kt)("td",{parentName:"tr",align:null},"Array<Buffer"),(0,l.kt)("td",{parentName:"tr",align:null},"Object>"),(0,l.kt)("td",{parentName:"tr",align:null},"\u53ef\u9009\uff0cHTTPS \u8bc1\u4e66 ca")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"hostname"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"\u76d1\u542c\u7684 hostname\uff0c\u9ed8\u8ba4 127.1"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"http2"),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"\u53ef\u9009\uff0chttp2 \u652f\u6301\uff0c\u9ed8\u8ba4 false"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("p",null,"\u8fd9\u4e9b\u53c2\u6570\u5728\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"bootstrap.js")," \u542f\u52a8\u65f6\u751f\u6548\u3002"),(0,l.kt)("h2",{id:"\u5e38\u89c1\u95ee\u9898"},"\u5e38\u89c1\u95ee\u9898"),(0,l.kt)("h3",{id:"\u9ed8\u8ba4\u7684-csrf-\u9519\u8bef"},"\u9ed8\u8ba4\u7684 csrf \u9519\u8bef"),(0,l.kt)("p",null,"\u5728 post \u8bf7\u6c42\uff0c\u7279\u522b\u662f\u7b2c\u4e00\u6b21\u65f6\u7528\u6237\u4f1a\u53d1\u73b0\u4e00\u4e2a csrf \u62a5\u9519\u3002\u539f\u56e0\u662f egg \u5728\u6846\u67b6\u4e2d\u9ed8\u8ba4\u5185\u7f6e\u4e86\u5b89\u5168\u63d2\u4ef6 \xa0",(0,l.kt)("a",{parentName:"p",href:"https://github.com/eggjs/egg-security"},"egg-security"),"\uff0c \u9ed8\u8ba4\u5f00\u542f\u4e86 csrf \u6821\u9a8c\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728\u914d\u7f6e\u4e2d\u5173\u95ed\u5b83\uff0c\u4f46\u662f\u66f4\u597d\u7684\u662f\u53bb",(0,l.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/core/security.html#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-csrf-%E7%9A%84%E9%98%B2%E8%8C%83"},(0,l.kt)("strong",{parentName:"a"},"\u4e86\u89e3\u5b83")),"\u4e4b\u540e\u518d\u505a\u9009\u62e9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"export const security = {\n  csrf: false,\n};\n")),(0,l.kt)("h2",{id:"\u5176\u4ed6"},"\u5176\u4ed6"),(0,l.kt)("h3",{id:"\u751f\u6210-ts-\u5b9a\u4e49"},"\u751f\u6210 ts \u5b9a\u4e49"),(0,l.kt)("p",null,"Midway \u63d0\u4f9b\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"@midwayjs/egg-ts-hepler"),"\xa0 \u5de5\u5177\u5305\uff0c\u7528\u4e8e\u5feb\u901f\u751f\u6210 EggJS \u5f00\u53d1\u65f6\u6240\u4f9d\u8d56\u7684\u5b9a\u4e49\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @midwayjs/egg-ts-helper --save-dev\n")),(0,l.kt)("p",null,"\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"package.json"),"\xa0 \u4e2d\u52a0\u5165\u5bf9\u5e94\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"ets"),"\xa0 \u547d\u4ee4\u5373\u53ef\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u5728 dev \u547d\u4ee4\u524d\u52a0\u5165\uff0c\u4ee5\u4fdd\u8bc1\u4ee3\u7801\u7684\u6b63\u786e\u6027\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'  "scripts": {\n    "dev": "cross-env ets && cross-env NODE_ENV=local midway-bin dev --ts",\n  },\n')),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5728\u7b2c\u4e00\u6b21\u7f16\u5199\u4ee3\u7801\u524d\uff0c\u9700\u8981\u6267\u884c\u4e00\u6b21\u6b64\u547d\u4ee4\u624d\u80fd\u6709 ts \u5b9a\u4e49\u751f\u6210\u3002")),(0,l.kt)("p",null,"EggJS \u751f\u6210\u7684\u5b9a\u4e49\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"typings"),"\xa0 \u76ee\u5f55\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\u279c  my_midway_app tree\n.\n\u251c\u2500\u2500 src                            ## midway \u9879\u76ee\u6e90\u7801\n\u251c\u2500\u2500 typings                        ## EggJS \u5b9a\u4e49\u751f\u6210\u76ee\u5f55\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 tsconfig.json\n")),(0,l.kt)("h3",{id:"eggjs-\u4e2d-configuration-\u7684\u7279\u6b8a\u60c5\u51b5"},"EggJS \u4e2d Configuration \u7684\u7279\u6b8a\u60c5\u51b5"),(0,l.kt)("p",null,"\u5728 EggJS \u4e0b\uff0c ",(0,l.kt)("inlineCode",{parentName:"p"},"configuration.ts"),"\xa0 \u4e2d\u7684\u751f\u547d\u5468\u671f",(0,l.kt)("strong",{parentName:"p"},"\u53ea\u4f1a\u5728 worker \u4e0b\u52a0\u8f7d\u6267\u884c"),"\u3002\u5982\u679c\u5728 Agent \u6709\u7c7b\u4f3c\u7684\u9700\u6c42\uff0c\u8bf7\u76f4\u63a5\u4f7f\u7528 EggJS \u81ea\u8eab\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"agent.ts"),"\xa0 \u5904\u7406\u3002"))}d.isMDXComponent=!0}}]);